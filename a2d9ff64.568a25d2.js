(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{147:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return b})),t.d(n,"metadata",(function(){return l})),t.d(n,"rightToc",(function(){return p})),t.d(n,"default",(function(){return i}));var a=t(3),r=t(8),c=(t(0),t(197)),b={title:"Django 2.0\u306bCelery 4.0\u3092\u5c0e\u5165\u3057\u3001WEB\u306e\u7ba1\u7406\u753b\u9762\u3067Cron\u3092\u7ba1\u7406\u3059\u308b",description:"\u7ba1\u7406\u753b\u9762\u3064\u304dCron Job\u306e\u6307\u5b9a",keywords:["celery","python","django","django \u5b9a\u671f\u5b9f\u884c","django celery","celery django","django-celery","django \u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u7ba1\u7406","django-celery-results","django-celery-beat","django scheduler","django_celery_beat"],createdAt:new Date("2018-03-12T01:39:51.000Z"),updatedAt:new Date("2019-05-21T11:22:01.000Z")},l={unversionedId:"python/django/introduction-of-celery-django",id:"python/django/introduction-of-celery-django",isDocsHomePage:!1,title:"Django 2.0\u306bCelery 4.0\u3092\u5c0e\u5165\u3057\u3001WEB\u306e\u7ba1\u7406\u753b\u9762\u3067Cron\u3092\u7ba1\u7406\u3059\u308b",description:"\u7ba1\u7406\u753b\u9762\u3064\u304dCron Job\u306e\u6307\u5b9a",source:"@site/docs/python/django/introduction-of-celery-django.md",slug:"/python/django/introduction-of-celery-django",permalink:"/docs/python/django/introduction-of-celery-django",editUrl:"https://github.com/Himenon/himenon.github.io/edit/default/docs/python/django/introduction-of-celery-django.md",version:"current",sidebar:"someSidebar",previous:{title:"Django\u306bApp\u3092\u65b0\u305f\u306b\u8ffd\u52a0\u3057\u305f\u3068\u304d\u306b\u3084\u308b\u3053\u3068",permalink:"/docs/python/django/initialize-new-app"},next:{title:"Django\u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u5206\u5272\u3057\u3066\u5229\u7528\u3059\u308b",permalink:"/docs/python/django/seperate-django-database"}},p=[{value:"\u306f\u3058\u3081\u306b",id:"\u306f\u3058\u3081\u306b",children:[{value:"\u985e\u4f3c\u6280\u8853",id:"\u985e\u4f3c\u6280\u8853",children:[]}]},{value:"\u6e96\u5099",id:"\u6e96\u5099",children:[]},{value:"Django\u306e\u4f5c\u6210",id:"django\u306e\u4f5c\u6210",children:[]},{value:"\u30bf\u30b9\u30af\u306e\u8ffd\u52a0",id:"\u30bf\u30b9\u30af\u306e\u8ffd\u52a0",children:[{value:"\u30a2\u30d7\u30ea\u306e\u8ffd\u52a0",id:"\u30a2\u30d7\u30ea\u306e\u8ffd\u52a0",children:[]},{value:"\u30bf\u30b9\u30af\u306e\u8ffd\u52a0",id:"\u30bf\u30b9\u30af\u306e\u8ffd\u52a0-1",children:[]},{value:"\u5b9f\u884c\u30bf\u30a4\u30df\u30f3\u30b0\u306e\u6307\u5b9a",id:"\u5b9f\u884c\u30bf\u30a4\u30df\u30f3\u30b0\u306e\u6307\u5b9a",children:[]}]},{value:"\u30bf\u30b9\u30af\u306e\u5b9f\u884c",id:"\u30bf\u30b9\u30af\u306e\u5b9f\u884c",children:[{value:"scheduler, worker\u306e\u8d77\u52d5",id:"scheduler-worker\u306e\u8d77\u52d5",children:[]}]},{value:"\u304a\u308f\u308a\u306b",id:"\u304a\u308f\u308a\u306b",children:[]}],o={rightToc:p};function i(e){var n=e.components,b=Object(r.a)(e,["components"]);return Object(c.b)("wrapper",Object(a.a)({},o,b,{components:n,mdxType:"MDXLayout"}),Object(c.b)("h2",{id:"\u306f\u3058\u3081\u306b"},"\u306f\u3058\u3081\u306b"),Object(c.b)("p",null,"Django 2.0\u306b\u5bfe\u3057\u3066\u3001Celery 4\u3092\u5c0e\u5165\u3057\u3066\u307f\u305f\u306e\u3067\u3001\u305d\u306e\u6642\u306e\u77e5\u898b\u3092\u66f8\u304f\u3002\n\u5c0e\u5165\u81ea\u4f53\u306f\u305d\u3046\u305d\u3046\u96e3\u3057\u304f\u306f\u306a\u304b\u3063\u305f\u304c\u3001\u3053\u308c\u3067\u52d5\u304f\u3001\u3068\u3044\u3063\u305f\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u304c\u306a\u304b\u306a\u304b\u7121\u304b\u3063\u305f\u306e\u3067\u3001\n\u66f8\u3044\u3066\u304a\u304d\u307e\u3059\u3002\u3002"),Object(c.b)("p",null,Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/Himenon/DjangoSample/tree/master/taskmanager_v1"}),"\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9")),Object(c.b)("h3",{id:"\u985e\u4f3c\u6280\u8853"},"\u985e\u4f3c\u6280\u8853"),Object(c.b)("p",null,"\u985e\u4f3c\u6280\u8853\u3067\u6709\u540d\u306a\u3082\u306e\u3068\u3057\u3066\u306f"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"cookpad/kuroko2: ",Object(c.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/cookpad/kuroko2"}),"https://github.com/cookpad/kuroko2")),Object(c.b)("li",{parentName:"ul"},"RUNDECK: ",Object(c.b)("a",Object(a.a)({parentName:"li"},{href:"http://rundeck.org/"}),"http://rundeck.org/"))),Object(c.b)("p",null,"\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u5b9f\u306fCelery\u3068Djagno\u3067\u3082\u540c\u3058\u3088\u3046\u306a\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3001Python\u3084\u3063\u3066\u3044\u308b\u4eba\u306f\u559c\u3073\u307e\u3057\u3087\u3046\u3002"),Object(c.b)("p",null,"\u624b\u3063\u53d6\u308a\u65e9\u3044\u306e\u306f",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/Himenon/DjangoSample/tree/master/taskmanager_v1"}),"\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9"),"\n\u3092\u3055\u3063\u3055\u3068\u8d77\u52d5\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u3053\u306e\u8a18\u4e8b\u306f\u89e3\u8aac\u306b\u6587\u5b57\u3092\u5272\u3044\u3066\u3044\u307e\u3059\u306e\u3067\u3002"),Object(c.b)("h2",{id:"\u6e96\u5099"},"\u6e96\u5099"),Object(c.b)("p",null,"\u672c\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u74b0\u5883\u3067\u4f5c\u6210\u3057\u305f\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"Django==2.0.3\ndjango-celery-results==1.0.1\ndjango-celery-beat==1.1.1\nredis==2.10.6\n")),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"requirements.txt"),"\u306b\u4e0a\u8a18\u3092\u8a18\u8ff0\u3057\u3001",Object(c.b)("inlineCode",{parentName:"p"},"pip install -r requirements.txt"),"\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304f\u3002"),Object(c.b)("h2",{id:"django\u306e\u4f5c\u6210"},"Django\u306e\u4f5c\u6210"),Object(c.b)("p",null,"1.\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u4f5c\u6210"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"django-admin startproject tm\n")),Object(c.b)("p",null,"\u3059\u308b\u3068\u6b21\u306e\u3088\u3046\u306a\u30c4\u30ea\u30fc\u304c\u4f5c\u6210\u3055\u308c\u308b\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),".\n\u251c\u2500\u2500 manage.py\n\u2514\u2500\u2500 tm\n    \u251c\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 settings.py\n    \u251c\u2500\u2500 urls.py\n    \u2514\u2500\u2500 wsgi.py\n")),Object(c.b)("p",null,"2.Extension\u306e\u8ffd\u52a0"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"tm/settings.py"),"\u306b\u6b21\u306e\u8a18\u8ff0\u3092\u5165\u308c\u307e\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"INSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n    'django_celery_beat',     # \u8ffd\u52a0\n    'django_celery_results',  # \u8ffd\u52a0\n]\n")),Object(c.b)("p",null,"3.",Object(c.b)("inlineCode",{parentName:"p"},"celery.py"),"\u306e\u8ffd\u52a0"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"tm/"),"\u4ee5\u4e0b\u306b",Object(c.b)("inlineCode",{parentName:"p"},"celery.py"),"\u3092\u8ffd\u52a0\u3059\u308b\u3002\ncelery\u306e\u540d\u524d\u7a7a\u9593\u3092\u6c5a\u67d3\u3057\u3066\u3044\u308b\u304c\u3001\u3053\u308c\u3067\u3042\u3063\u3066\u3044\u308b\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),".\n\u251c\u2500\u2500 manage.py\n\u2514\u2500\u2500 tm\n    \u251c\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 celery.py     # \u8ffd\u52a0\n    \u251c\u2500\u2500 settings.py\n    \u251c\u2500\u2500 urls.py\n    \u2514\u2500\u2500 wsgi.py\n")),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"celery.py"),"\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3059\u308b\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"from os import environ\nfrom celery import Celery\napp = Celery('tm', broker=environ.get('BROKER_URL'))\napp.config_from_object('django.conf:settings', namespace='CELERY')\napp.autodiscover_tasks()\n")),Object(c.b)("p",null,"\u3053\u308c\u306f\u3001\u5f8c\u3005\u767b\u5834\u3059\u308b",Object(c.b)("inlineCode",{parentName:"p"},"@task"),"\u3082\u3057\u304f\u306f",Object(c.b)("inlineCode",{parentName:"p"},"@shared_task"),"\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u3001worker\u8d77\u52d5\u6642\u306b\u3001\n\u81ea\u52d5\u7684\u306b",Object(c.b)("inlineCode",{parentName:"p"},"INSTALLED_APPS"),"\u304b\u3089\u63a2\u7d22\u3059\u308b\u5f79\u5272\u3092\u679c\u305f\u3059\u3002"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"BROKER_URL"),"\u306f\u3001\u74b0\u5883\u5909\u6570\u304b\u3089\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3042\u308b\u3002\u3053\u308c\u306f\u72b6\u6cc1\u306b\u5408\u308f\u305b\u3066\u5909\u5316\u3057\u3066\u6b32\u3057\u3044\u3002"),Object(c.b)("p",null,"4.",Object(c.b)("inlineCode",{parentName:"p"},"__init__.py"),"\u306bapp\u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3059\u308b\u3002"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"tm/__init__.py"),"\u306bCelery\u3092\u547c\u3073\u51fa\u3059\u30b3\u30fc\u30c9\u8a18\u8ff0\u3057\u3066\u304a\u304f\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"from .celery import app as celery_app\n\n__all__ = ['celery_app']\n")),Object(c.b)("p",null,"5.Migration"),Object(c.b)("p",null,"Celery\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306fDatabase\u3078\u306eMigration\u3092\u5fc5\u8981\u3068\u3057\u307e\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"python3 manage.py migrate\n")),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"django-celery-beat"),"\u306f\u30bf\u30b9\u30af\u306e\u5b9f\u884c\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u7ba1\u7406\u306e\u305f\u3081\u306b\u3001\n",Object(c.b)("inlineCode",{parentName:"p"},"django-celery-results"),"\u306f\u5b9f\u884c\u4e94\u306e\u7d50\u679c\u3092\u4fdd\u5b58\u3057\u3066\u304a\u304f\u305f\u3081\u306bDatabase\u3092\u5229\u7528\u3057\u307e\u3059\u3002"),Object(c.b)("p",null,"\u307e\u305f\u3001Admin\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"python3 manage.py createsuperuser\n")),Object(c.b)("p",null,"\u3067\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\u3053\u3053\u307e\u3067\u3046\u307e\u304f\u3044\u304f\u3068\u3001\u6b21\u306e\u753b\u50cf\u306e\u3088\u3046\u306b\u7ba1\u7406\u753b\u9762\u306b\u3001\u30bf\u30b9\u30af\u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u7ba1\u7406\u306e\u753b\u9762\u304c\u51fa\u73fe\u3057\u307e\u3059\u3002\n\u5b9a\u671f\u5b9f\u884c\u30bf\u30b9\u30af\u306e\u7ba1\u7406\u304c\u3053\u3053\u304b\u3089\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002"),Object(c.b)("p",null,Object(c.b)("img",{alt:"Celery\u3092\u8ffd\u52a0\u3057\u305f\u3068\u304d\u306e\u7ba1\u7406\u753b\u9762",src:t(269).default})),Object(c.b)("p",null,"\u6b21\u306b\u3001\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u3066\u304d\u307e\u3059\u3002"),Object(c.b)("h2",{id:"\u30bf\u30b9\u30af\u306e\u8ffd\u52a0"},"\u30bf\u30b9\u30af\u306e\u8ffd\u52a0"),Object(c.b)("h3",{id:"\u30a2\u30d7\u30ea\u306e\u8ffd\u52a0"},"\u30a2\u30d7\u30ea\u306e\u8ffd\u52a0"),Object(c.b)("p",null,"\u30bf\u30b9\u30af\u306e\u8ffd\u52a0\u306e\u524d\u306b\u3001\u30a2\u30d7\u30ea\u306e\u8ffd\u52a0\u3092\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n",Object(c.b)("inlineCode",{parentName:"p"},"manage.py"),"\u306e\u3042\u308b\u3068\u3053\u308d\u3067\u3001\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53e9\u304d\u307e\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"python3 manage.py startapp tapp_a\npython3 manage.py startapp tapp_b\n")),Object(c.b)("p",null,"\u4eca\u56de\u306f\u30a2\u30d7\u30ea\u540c\u58eb\u306e\u76f8\u4e92\u547c\u3073\u51fa\u3057\u3082\u691c\u8a3c\u3059\u308b\u305f\u3081\u30012\u3064\u306e\u30a2\u30d7\u30ea\u3092\u8ffd\u52a0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n",Object(c.b)("inlineCode",{parentName:"p"},"INSTALLED_APPS"),"\u306f\u6b21\u306e\u3088\u3046\u306b\u66f4\u65b0\u3057\u3066\u304a\u304d\u307e\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"INSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n    'django_celery_beat',\n    'django_celery_results',\n    'tapp_a',    # \u8ffd\u52a0\n    'tapp_b',    # \u8ffd\u52a0\n]\n")),Object(c.b)("h3",{id:"\u30bf\u30b9\u30af\u306e\u8ffd\u52a0-1"},"\u30bf\u30b9\u30af\u306e\u8ffd\u52a0"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"tapp_a"),"\u306b\u30b7\u30f3\u30d7\u30eb\u306a\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n",Object(c.b)("inlineCode",{parentName:"p"},"tasks.py"),"\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001\u6b21\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),'from celery import shared_task\n\n@shared_task\ndef hello_from_a(*args, **kwargs):\n    print("Hello! From A")\n    print("args = {}".format(args))\n    print("kwargs = {}".format(kwargs))\n')),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"@shared_task"),"\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001Django Admin\u3067\u8a8d\u8b58\u3055\u308c\u307e\u3059\u3002\n\u753b\u50cf\u3067\u306fPeriodic Tasks\u306e\u7ba1\u7406\u753b\u9762\u4e2d\u3067\u3001\u3044\u304f\u3064\u304b\u306e\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u305f\u5834\u5408\u306e\u3082\u306e\u3092\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002"),Object(c.b)("p",null,Object(c.b)("img",{alt:"\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u305f\u6642",src:t(270).default})),Object(c.b)("p",null,"\u307e\u305f\u3001\u767b\u9332\u3057\u305f\u30bf\u30b9\u30af\u306b\u521d\u671f\u5024\u3092\u4e0e\u3048\u305f\u3044\u5834\u5408\u306f",Object(c.b)("inlineCode",{parentName:"p"},"Arguments"),"\u3092\u5229\u7528\u3059\u308b\u3068\u53ef\u80fd\u3067\u3059\u3002"),Object(c.b)("p",null,Object(c.b)("img",{alt:"\u5f15\u6570\u306b\u5024\u3092\u6e21\u3057\u305f\u3044\u5834\u5408",src:t(271).default})),Object(c.b)("h3",{id:"\u5b9f\u884c\u30bf\u30a4\u30df\u30f3\u30b0\u306e\u6307\u5b9a"},"\u5b9f\u884c\u30bf\u30a4\u30df\u30f3\u30b0\u306e\u6307\u5b9a"),Object(c.b)("p",null,"\u5b9f\u884c\u30bf\u30a4\u30df\u30f3\u30b0\u306e\u6307\u5b9a\u306f\u3001Interval\u3001Crontab\u3001Solar\u306e3\u3064\u306e\u3046\u30611\u3064\u306e\u307f\u304c\u9078\u629e\u53ef\u80fd\u3067\u3059\u3002\n\u3069\u3046\u3057\u3066\u3082\u6570\u7a2e\u985e\u306e\u5b9f\u884c\u65b9\u6cd5\u304c\u5fc5\u8981\u306a\u5834\u5408\u306f\u3001\u5225\u30bf\u30b9\u30af\u3068\u3057\u3066\u767b\u9332\u3057\u76f4\u3057\u307e\u3059\u3002"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"Interval: 10\u79d2\u3054\u3068\u306a\u3069\u3002\u4e00\u5b9a\u9593\u9694\u3067\u884c\u3046"),Object(c.b)("li",{parentName:"ul"},"Crontab: \u6307\u5b9a\u3057\u305f\u65e5\u6642\u3067\u5b9f\u884c\u3092\u884c\u3046"),Object(c.b)("li",{parentName:"ul"},"Solar: \u6307\u5b9a\u3057\u305f\u7def\u5ea6\u7d4c\u5ea6\u306b\u57fa\u3065\u3044\u305f\u3001\u65e5\u306e\u51fa\u3001\u65e5\u6ca1\u306a\u3069\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u81ea\u52d5\u7684\u306b\u5b9f\u884c\u3059\u308b")),Object(c.b)("p",null,"\u3053\u308c\u306f\u304a\u597d\u307f\u3067\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002"),Object(c.b)("p",null,"\u3053\u3053\u307e\u3067\u7d42\u308f\u308c\u3070\u3001\u30bf\u30b9\u30af\u306e\u767b\u9332\u304c\u5b8c\u4e86\u3067\u3059\u3002"),Object(c.b)("h2",{id:"\u30bf\u30b9\u30af\u306e\u5b9f\u884c"},"\u30bf\u30b9\u30af\u306e\u5b9f\u884c"),Object(c.b)("p",null,"\u5b9a\u671f\u5b9f\u884c\u30bf\u30b9\u30af\u306b\u95a2\u3057\u3066\u306f\u3001Scheduler\u3068Worker\u3001Broker\u3092Django\u3068\u306f\u5225\u306e\u30d7\u30ed\u30bb\u30b9\u3067\u8d77\u52d5\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/Himenon/DjangoSample/tree/master/taskmanager_v1"}),"\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9"),"\u3067\u306f\u3001\ndocker-compose\u3092\u7528\u3044\u3066\u697d\u3092\u3057\u3066\u3044\u307e\u3059\u3002"),Object(c.b)("p",null,"\u305f\u3060\u3001\u3053\u3053\u306f\u305d\u308c\u307b\u3069\u96e3\u3057\u3082\u306e\u3067\u306f\u306a\u304f\u3001\u8d77\u52d5\u30b3\u30de\u30f3\u30c9\u304c\u7570\u306a\u308b\u3060\u3051\u3068\u306a\u308a\u307e\u3059\u3002\nBroker\u306b\u95a2\u3057\u3066\u306f\u4eca\u56de\u306fredis\u3092\u63a1\u7528\u3057\u3066\u304a\u308a\u3001\u81ea\u52d5\u7684\u306b\u7acb\u3061\u4e0a\u304c\u308b\u306e\u3067\u3001\u3053\u3053\u3067\u306e\u8aac\u660e\u306f\u7701\u304d\u307e\u3059\u3002"),Object(c.b)("h3",{id:"scheduler-worker\u306e\u8d77\u52d5"},"scheduler, worker\u306e\u8d77\u52d5"),Object(c.b)("p",null,"scheduler\u306e\u8d77\u52d5\u30b3\u30de\u30f3\u30c9\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"DJANGO_SETTINGS_MODULE=tm.settings celery -A tm beat --scheduler django_celery_beat.schedulers:DatabaseScheduler --pidfile /celerybeat.pid\n")),Object(c.b)("p",null,"worker\u306e\u8d77\u52d5\u30b3\u30de\u30f3\u30c9\u306f\u6b21\u306e\u3068\u304a\u308a\u3067\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),'bash -c "DJANGO_SETTINGS_MODULE=tm.settings celery -A tm worker"\n')),Object(c.b)("h4",{id:"\u89e3\u8aac"},"\u89e3\u8aac"),Object(c.b)("h5",{id:"worker\u306b\u3064\u3044\u3066"},"worker\u306b\u3064\u3044\u3066"),Object(c.b)("p",null,"\u3053\u3053\u3067\u91cd\u8981\u306a\u30dd\u30a4\u30f3\u30c8\u306f",Object(c.b)("inlineCode",{parentName:"p"},"DJANGO_SETTINGS_MODULE=tm.settings"),"\u3067\u3059\u3002\n(\u3053\u308c\u3092\u5fd8\u308c\u308b\u3068\u3072\u3069\u304f\u6cbc\u306b\u306f\u307e\u308a\u307e\u3059\u3002)"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"celery -A tm"),"\u306f",Object(c.b)("inlineCode",{parentName:"p"},"tm/__init__.py"),"\u3092\u898b\u306b\u884c\u304d\u307e\u3059\u3002\u3053\u3053\u306b",Object(c.b)("inlineCode",{parentName:"p"},"celery_app"),"\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306f\u30a8\u30e9\u30fc\u3068\u306a\u308a\u307e\u3059\u3002\n\u6b21\u306b\u3001",Object(c.b)("inlineCode",{parentName:"p"},"celery.py"),"\u306e",Object(c.b)("inlineCode",{parentName:"p"},"app.config_from_object"),"\u3068",Object(c.b)("inlineCode",{parentName:"p"},"app.autodiscover_tasks"),"\u306b\u304a\u3044\u3066\u306f\u3001\nDjango\u306e",Object(c.b)("inlineCode",{parentName:"p"},"settings.py"),"\u3092\u63a2\u7d22\u3057\u306b\u884c\u304d\u307e\u3059\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"app.config_from_object('django.conf:settings', namespace='CELERY')\n")),Object(c.b)("p",null,"\u901a\u5e38\u3001DEBUG\u30b5\u30fc\u30d0\u30fc\u306a\u3069\u7acb\u3061\u4e0a\u3052\u308b\u6642\u3001",Object(c.b)("inlineCode",{parentName:"p"},"python3 manage.py runserver"),"\u306a\u3069\u3068\u3057\u307e\u3059\u304c\u3001\n\u30b3\u30fc\u30c9\u3092\u898b\u308b\u3068"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),'os.environ.setdefault("DJANGO_SETTINGS_MODULE", "tm.settings")\n')),Object(c.b)("p",null,"\u304c\u8d70\u3063\u3066\u3044\u307e\u3059\u3002\u3064\u307e\u308a\u3001\u8d77\u52d5\u6642\u306b\u74b0\u5883\u5909\u6570\u3092\u767b\u9332\u3057\u3066\u3044\u308b\u305f\u3081\u3001Django\u3092\u5229\u7528\u3059\u308bcelery\u3082\u74b0\u5883\u5909\u6570\u3001\u3082\u3057\u304f\u306f\u5909\u6570\u3092\n\u8d77\u52d5\u6642\u306b\u5b9a\u7fa9\u3057\u3066\u304a\u304b\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002"),Object(c.b)("p",null,"\u30bf\u30b9\u30af\u306e\u8a8d\u8b58\u306b\u95a2\u3057\u3066\u306f\u3001"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"app.autodiscover_tasks()\n")),Object(c.b)("p",null,"\u304c\u81ea\u52d5\u7684\u306b",Object(c.b)("inlineCode",{parentName:"p"},"settings.py"),"\u304b\u3089",Object(c.b)("inlineCode",{parentName:"p"},"INSTALLED_APPS"),"\u3092\u5438\u3063\u3066\u304d\u3066\u89e3\u6c7a\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u305e\u308c\u306e",Object(c.b)("inlineCode",{parentName:"p"},"APP"),"\u3067\nWorker\u3092\u660e\u793a\u7684\u306b\u8d77\u52d5\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u3080\u3057\u308d\u3001\u305d\u308c\u3092\u884c\u3063\u305f\u5834\u5408\u3001",Object(c.b)("inlineCode",{parentName:"p"},"APP"),"\u9593\u3067Model\u3092\u53c2\u7167\u3059\u308b\u3068\u3044\u3063\u305f\u3053\u3068\u304c\u3067\u304d\u306a\u304f\u306a\u308a\u307e\u3059\u3002"),Object(c.b)("h5",{id:"scheduler\u306b\u3064\u3044\u3066"},"scheduler\u306b\u3064\u3044\u3066"),Object(c.b)("p",null,"Scheduler\u306e\u5f79\u5272\u306f\u81f3\u3063\u3066\u30b7\u30f3\u30d7\u30eb\u3067\u3059\u3002"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"Database\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u30bf\u30b9\u30af\u306e\u76e3\u8996"),Object(c.b)("li",{parentName:"ol"},"\u6307\u5b9a\u306e\u6642\u523b\u306b\u306a\u3063\u305f\u6642\u3001Broker\u306b\u5bfe\u3057\u3066Worker\u304c\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1")),Object(c.b)("p",null,"1\u306e\u304a\u304b\u3052\u3067\u3001Django Admin\u3067\u30bf\u30b9\u30af\u3092\u767b\u9332\u3001\u7de8\u96c6\u3001\u524a\u9664\u3057\u305f\u6642\u306b\u81ea\u52d5\u7684\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002\n2\u306fBroker\u3078\u767b\u9332\u3055\u308c\u305f\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u6295\u3052\u308b\u3060\u3051\u3067\u3059\u3002\n\u5b9f\u969b\u306b\u5b9f\u884c\u3055\u308c\u308b\u304b\u3069\u3046\u304b\u306f\u4fdd\u8a3c\u3055\u308c\u307e\u305b\u3093\u3002"),Object(c.b)("p",null,"\u305d\u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3092\u7ba1\u7406\u3059\u308b\u305f\u3081\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u3057\u3066\u3001\n",Object(c.b)("inlineCode",{parentName:"p"},"--scheduler django_celery_beat.schedulers:DatabaseScheduler"),"\u3092\u6307\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u672a\u6307\u5b9a\u306e\u5834\u5408\u306f\u3001\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306bScheduler\u306e\u7ba1\u7406\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n",Object(c.b)("inlineCode",{parentName:"p"},"django_celery_beat.schedulers:DatabaseScheduler"),"\u3092\u6307\u5b9a\u3057\u3066\u308b\u5834\u5408\u306f\u3001\nDjando Admin\u3067\u306f\u898b\u3048\u307e\u305b\u3093\u304c\u3001Database\u4e0a\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u304c\u8a18\u8ff0\u3055\u308c\u3001\u4eee\u306bScheduler\u304c\u843d\u3061\u305f\u3068\u3057\u3066\u3082\u3001\n\u3069\u306e\u30bf\u30b9\u30af\u304c\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3055\u308c\u3066\u3044\u308b\u304b\u306f\u6b8b\u308a\u307e\u3059\u3002"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"--pidfile /celerybeat.pid"),"\u3068\u3057\u3066\u3044\u308b\u306e\u306f\u3001\u958b\u767a\u4e0a\u306e\u90fd\u5408\u3068\u3044\u3048\u3070\u305d\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\u8d77\u52d5\u5834\u6240\u306b",Object(c.b)("inlineCode",{parentName:"p"},"pid"),"\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u304c\u3001Scheduler\u3092\u518d\u8d77\u52d5\u3057\u305f\u5834\u5408\u306b\u3001\n",Object(c.b)("inlineCode",{parentName:"p"},"pid"),"\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u305f\u5834\u5408\u3001Scheduler\u306e\u591a\u91cd\u8d77\u52d5\u3092\u9632\u3050\u305f\u3081\u306bScheduler\u304c\u8d77\u52d5\u3057\u307e\u305b\u3093\u3002"),Object(c.b)("p",null,"\u30b3\u30f3\u30c6\u30ca\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u826f\u304f\u30b3\u30f3\u30c6\u30ca\u3054\u3068\u843d\u3068\u3059\u305f\u3081\u3001\u3053\u308c\u306f\u4e0d\u4fbf\u306a\u305f\u3081\u3001\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u306a\u30b3\u30f3\u30c6\u30ca\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b",Object(c.b)("inlineCode",{parentName:"p"},"pid"),"\u30d5\u30a1\u30a4\u30eb\u3092\u6295\u3052\u3066\u3044\u307e\u3059\u3002\n\u5b9f\u969b\u306b\u904b\u7528\u3059\u308b\u3068\u304d\u306f\u3001Scheduler\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u30b5\u30a4\u30ba\u30921\u306e\u307e\u307e\u306b\u3057\u3066\u304a\u304f\u306e\u304c\u666e\u901a\u304b\u3068\u601d\u3044\u307e\u3059\u3002"),Object(c.b)("p",null,"\u3069\u3046\u3057\u3066\u3082Scheduler\u3092\u5197\u9577\u5316\u3059\u308b\u305f\u3081\u306b\u8907\u6570\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u5404\u30b3\u30f3\u30c6\u30ca\u306b\u6c38\u7d9a\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3001",Object(c.b)("inlineCode",{parentName:"p"},"pid"),"\u30d5\u30a1\u30a4\u30eb\u304c\n\u4e00\u610f\u306b\u306a\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u304c...."),Object(c.b)("h2",{id:"\u304a\u308f\u308a\u306b"},"\u304a\u308f\u308a\u306b"),Object(c.b)("p",null,"\u3053\u3053\u307e\u3067\u3067\u3001\u30bf\u30b9\u30af\u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u5b9f\u884c\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3059\u3002\n\u9577\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u305d\u3046\u306a\u306e\u3067\u3001\u8aac\u660e\u306f\u3053\u3053\u307e\u3067\u306b\u3057\u307e\u3059\u304c\u3001",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/Himenon/DjangoSample/tree/master/taskmanager_v1"}),"\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9"),"\n\u3067\u306f\u3082\u3046\u3061\u3087\u3063\u3068\u30b5\u30f3\u30d7\u30eb\u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\u8208\u5473\u304c\u3042\u308b\u4eba\u306f\u305c\u3072\u3054\u89a7\u304f\u3060\u3055\u3044\u3002"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"\u53c2\u8003")),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("a",Object(a.a)({parentName:"li"},{href:"http://docs.celeryproject.org/en/latest/userguide/periodic-tasks.html"}),"Periodic Tasks | Celery 4.1.0 documentation"))))}i.isMDXComponent=!0},197:function(e,n,t){"use strict";t.d(n,"a",(function(){return j})),t.d(n,"b",(function(){return u}));var a=t(0),r=t.n(a);function c(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function b(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?b(Object(t),!0).forEach((function(n){c(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):b(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},c=Object.keys(e);for(a=0;a<c.length;a++)t=c[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)t=c[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var o=r.a.createContext({}),i=function(e){var n=r.a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},j=function(e){var n=i(e.components);return r.a.createElement(o.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},s=r.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,c=e.originalType,b=e.parentName,o=p(e,["components","mdxType","originalType","parentName"]),j=i(t),s=a,u=j["".concat(b,".").concat(s)]||j[s]||d[s]||c;return t?r.a.createElement(u,l(l({ref:n},o),{},{components:t})):r.a.createElement(u,l({ref:n},o))}));function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var c=t.length,b=new Array(c);b[0]=s;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:a,b[1]=l;for(var o=2;o<c;o++)b[o]=t[o];return r.a.createElement.apply(null,b)}return r.a.createElement.apply(null,t)}s.displayName="MDXCreateElement"},269:function(e,n,t){"use strict";t.r(n),n.default=t.p+"assets/images/celery-django-admin-f1d2face696c4739b08510ba5e1e23eb.png"},270:function(e,n,t){"use strict";t.r(n),n.default=t.p+"assets/images/celery-django-admin-add-tasks-74a4d89ed79336a9fc363cb0967c4fa7.png"},271:function(e,n,t){"use strict";t.r(n),n.default=t.p+"assets/images/celery-django-admin-args-4f52c5911ae54f4dda28f9645a29b172.png"}}]);