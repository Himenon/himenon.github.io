<html>

  <head lang="ja">
    <title>NodeJSでローカルのファイルを操作するときのwrapper</title>
    <meta charSet="utf-8" />
    <meta name="keywords" content="nodejs,filesystem" />
    <meta name="description" content="fs-extraとpathを利用してよく使うパターンにまとめます。直接使うのも良いですが、デバッグ用のログを仕込んだりMockテストをすることを考えると一層間に噛ませると融通が効きます。" />
    <meta name="copyright" content="@Himenon" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@Himenon" />
    <meta property="og:title" content="NodeJSでローカルのファイルを操作するときのwrapper" />
    <meta property="og:url" content="https://himenon.github.io/javascript/treat-local-filesystem-methods" />
    <meta property="og:description" content="fs-extraとpathを利用してよく使うパターンにまとめます。直接使うのも良いですが、デバッグ用のログを仕込んだりMockテストをすることを考えると一層間に噛ませると融通が効きます。" />
    <meta property="og:image" content="https://himenon.github.io/assets/images/miku.png" />
    <meta name="viewport" content="initial-scale=1,minimum-scale=0.5,user-scalable=no" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/miku.png?6f93c" />
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png?bcd9b" />
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png?319f2" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:600,800?55911" rel="stylesheet" />
    <link href="/lib/prism.css?f5393" rel="stylesheet" />
    <link href="/assets/stylesheets/styles.css?1db30" rel="stylesheet" />
    <script>
      (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
          m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
      })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'UA-55455343-7', 'auto');
      ga('send', 'pageview');
    </script>
    <script id="csr-props" data-csr-props="{&quot;htmlMetaData&quot;:{&quot;lang&quot;:&quot;ja&quot;,&quot;title&quot;:&quot;NodeJSでローカルのファイルを操作するときのwrapper&quot;,&quot;description&quot;:&quot;fs-extraとpathを利用してよく使うパターンにまとめます。直接使うのも良いですが、デバッグ用のログを仕込んだりMockテストをすることを考えると一層間に噛ませると融通が効きます。&quot;,&quot;keywords&quot;:&quot;nodejs,filesystem&quot;,&quot;copyright&quot;:&quot;@Himenon&quot;,&quot;viewport&quot;:{&quot;initial-scale&quot;:1,&quot;minimum-scale&quot;:0.5,&quot;user-scalable&quot;:&quot;no&quot;},&quot;thirdParty&quot;:{&quot;googleAnalytics&quot;:{&quot;ua&quot;:&quot;UA-55455343-7&quot;}},&quot;js&quot;:[],&quot;css&quot;:[&quot;https://fonts.googleapis.com/css?family=Open+Sans:600,800&quot;,&quot;./node_modules/prismjs/themes/prism.css&quot;,&quot;/assets/stylesheets/styles.css&quot;],&quot;link&quot;:[{&quot;rel&quot;:&quot;apple-touch-icon&quot;,&quot;sizes&quot;:&quot;180x180&quot;,&quot;href&quot;:&quot;assets/images/miku.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;32x32&quot;,&quot;href&quot;:&quot;assets/images/favicon-32x32.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;16x16&quot;,&quot;href&quot;:&quot;assets/images/favicon-16x16.png&quot;}],&quot;createdAt&quot;:&quot;2019-06-12T22:59:00.000Z&quot;,&quot;updatedAt&quot;:&quot;2019-06-12T22:59:00.000Z&quot;,&quot;globalScripts&quot;:[],&quot;globalLinks&quot;:[{&quot;rel&quot;:&quot;apple-touch-icon&quot;,&quot;sizes&quot;:&quot;180x180&quot;,&quot;href&quot;:&quot;/assets/images/miku.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;32x32&quot;,&quot;href&quot;:&quot;/assets/images/favicon-32x32.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;16x16&quot;,&quot;href&quot;:&quot;/assets/images/favicon-16x16.png&quot;},&quot;https://fonts.googleapis.com/css?family=Open+Sans:600,800&quot;,&quot;/lib/prism.css&quot;,&quot;/assets/stylesheets/styles.css&quot;],&quot;localLinks&quot;:[],&quot;extend&quot;:{&quot;meta&quot;:[{&quot;name&quot;:&quot;twitter:card&quot;,&quot;content&quot;:&quot;summary&quot;},{&quot;name&quot;:&quot;twitter:site&quot;,&quot;content&quot;:&quot;@Himenon&quot;},{&quot;property&quot;:&quot;og:title&quot;,&quot;content&quot;:&quot;NodeJSでローカルのファイルを操作するときのwrapper&quot;},{&quot;property&quot;:&quot;og:url&quot;,&quot;content&quot;:&quot;https://himenon.github.io/javascript/treat-local-filesystem-methods&quot;},{&quot;property&quot;:&quot;og:description&quot;,&quot;content&quot;:&quot;fs-extraとpathを利用してよく使うパターンにまとめます。直接使うのも良いですが、デバッグ用のログを仕込んだりMockテストをすることを考えると一層間に噛ませると融通が効きます。&quot;},{&quot;property&quot;:&quot;og:image&quot;,&quot;content&quot;:&quot;https://himenon.github.io/assets/images/miku.png&quot;}]}},&quot;page&quot;:{&quot;uri&quot;:&quot;/javascript/treat-local-filesystem-methods&quot;,&quot;content&quot;:&quot;\n## サンプルコード\n\n```typescript\n// filesystem.ts\nimport * as fs from \&quot;fs-extra\&quot;;\nimport * as path from \&quot;path\&quot;;\n\n/** ファイルがファイルとして存在するか. */\nexport const existFile = (filename: string) =&gt; {\n  return fs.existsSync(filename) &amp;&amp; fs.statSync(filename).isFile();\n};\n\n/** ディレクトリがディレクトリとして存在するか. */\nexport const existDirectory = (dirname: string) =&gt; {\n  return fs.existsSync(dirname) &amp;&amp; fs.statSync(dirname).isDirectory();\n};\n\n/** ディレクトリで在るかどうか. */\nconst isDirectory = (dirname: string) =&gt; {\n  return fs.existsSync(dirname) &amp;&amp; fs.statSync(dirname).isDirectory();\n};\n\n/** ディレクトリの作成.`mkdir -p`と同じ挙動をする. */\nexport const mkdirP = (dirPath: string) =&gt; {\n  if (!fs.existsSync(dirPath) || !fs.statSync(dirPath).isDirectory()) {\n    fs.mkdirSync(dirPath, { recursive: true });\n  }\n};\n\n/** テキストデータの同期的な保存. */\nexport const saveFile = (filename: string, data: string): void =&gt; {\n  fs.writeFileSync(filename, data, { encoding: \&quot;utf-8\&quot; });\n};\n\n/** JSON形式のデータの同期的な保存. */\nexport const saveJson = &lt;T&gt;(filename: string, config: T): void =&gt; {\n  try {\n    fs.writeFileSync(filename, JSON.stringify(config, null, 2), { encoding: \&quot;utf-8\&quot; });\n  } catch (e) {\n    console.error(e);\n  }\n};\n\n/** JSON形式のデータの同期的な読み込み. */\nexport const readJson = &lt;T&gt;(filename: string): T | undefined =&gt; {\n  if (!existFile(filename)) {\n    return;\n  }\n  try {\n    return JSON.parse(fs.readFileSync(filename, { encoding: \&quot;utf-8\&quot; }));\n  } catch (e) {\n    console.error(e);\n  }\n  return undefined;\n};\n\n/** 指定した拡張子の再帰的なファイルのコピー. */\nexport const copyFiles = (source: string, destination: string, extensions: string[]) =&gt; {\n  fs.copy(source, destination, {\n    filter: (targetPath: string) =&gt; {\n      return isDirectory(targetPath) || extensions.includes(path.extname(targetPath));\n    },\n    recursive: true,\n  });\n};\n```\n\n## 解説\n\nあくまで目的は**ローカル**でのファイル操作に焦点をあてた、ファイル操作のラッパーを提供することです。\n高速に処理することではなく、人間が理解できる処理内容になっていることを求めます。\n「人間が理解できる処理内容」を具体的に定義するならば、\n\n1. 同期的である\n   * 順序を整理しやすい\n2. 処理の対象が明確である\n   * `any`型がない\n3. 話し言葉に関数名が定義されている\n   * save, writeどっちかに寄せるなど\n4. デバッグしやすい状態\n   * ログを仕込みやすい\n5. コメントがある\n   * 言わずもがな\n\nこれらのことが満たされていると理解しやすくなります。\n\n## 参考\n\n* [jprichardson/node\\-fs\\-extra: Node\\.js: extra methods for the fs object like copy\\(\\), remove\\(\\), mkdirs\\(\\)](https://github.com/jprichardson/node-fs-extra)\n&quot;,&quot;metaData&quot;:{&quot;lang&quot;:&quot;ja&quot;,&quot;title&quot;:&quot;NodeJSでローカルのファイルを操作するときのwrapper&quot;,&quot;description&quot;:&quot;fs-extraとpathを利用してよく使うパターンにまとめます。直接使うのも良いですが、デバッグ用のログを仕込んだりMockテストをすることを考えると一層間に噛ませると融通が効きます。&quot;,&quot;keywords&quot;:&quot;nodejs,filesystem&quot;,&quot;copyright&quot;:&quot;@Himenon&quot;,&quot;viewport&quot;:{&quot;initial-scale&quot;:1,&quot;minimum-scale&quot;:0.5,&quot;user-scalable&quot;:&quot;no&quot;},&quot;thirdParty&quot;:{&quot;googleAnalytics&quot;:{&quot;ua&quot;:&quot;UA-55455343-7&quot;}},&quot;js&quot;:[],&quot;css&quot;:[&quot;https://fonts.googleapis.com/css?family=Open+Sans:600,800&quot;,&quot;./node_modules/prismjs/themes/prism.css&quot;,&quot;/assets/stylesheets/styles.css&quot;],&quot;link&quot;:[{&quot;rel&quot;:&quot;apple-touch-icon&quot;,&quot;sizes&quot;:&quot;180x180&quot;,&quot;href&quot;:&quot;assets/images/miku.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;32x32&quot;,&quot;href&quot;:&quot;assets/images/favicon-32x32.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;16x16&quot;,&quot;href&quot;:&quot;assets/images/favicon-16x16.png&quot;}],&quot;createdAt&quot;:&quot;2019-06-12T22:59:00.000Z&quot;,&quot;updatedAt&quot;:&quot;2019-06-12T22:59:00.000Z&quot;,&quot;globalScripts&quot;:[],&quot;globalLinks&quot;:[{&quot;rel&quot;:&quot;apple-touch-icon&quot;,&quot;sizes&quot;:&quot;180x180&quot;,&quot;href&quot;:&quot;/assets/images/miku.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;32x32&quot;,&quot;href&quot;:&quot;/assets/images/favicon-32x32.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;16x16&quot;,&quot;href&quot;:&quot;/assets/images/favicon-16x16.png&quot;},&quot;https://fonts.googleapis.com/css?family=Open+Sans:600,800&quot;,&quot;/lib/prism.css&quot;,&quot;/assets/stylesheets/styles.css&quot;],&quot;localLinks&quot;:[],&quot;extend&quot;:{&quot;meta&quot;:[{&quot;name&quot;:&quot;twitter:card&quot;,&quot;content&quot;:&quot;summary&quot;},{&quot;name&quot;:&quot;twitter:site&quot;,&quot;content&quot;:&quot;@Himenon&quot;},{&quot;property&quot;:&quot;og:title&quot;,&quot;content&quot;:&quot;NodeJSでローカルのファイルを操作するときのwrapper&quot;},{&quot;property&quot;:&quot;og:url&quot;,&quot;content&quot;:&quot;https://himenon.github.io/javascript/treat-local-filesystem-methods&quot;},{&quot;property&quot;:&quot;og:description&quot;,&quot;content&quot;:&quot;fs-extraとpathを利用してよく使うパターンにまとめます。直接使うのも良いですが、デバッグ用のログを仕込んだりMockテストをすることを考えると一層間に噛ませると融通が効きます。&quot;},{&quot;property&quot;:&quot;og:image&quot;,&quot;content&quot;:&quot;https://himenon.github.io/assets/images/miku.png&quot;}]}},&quot;ext&quot;:&quot;.md&quot;,&quot;filename&quot;:&quot;src/javascript/treat-local-filesystem-methods.md&quot;,&quot;name&quot;:&quot;javascript/treat-local-filesystem-methods&quot;,&quot;raw&quot;:&quot;---\ntitle: \&quot;NodeJSでローカルのファイルを操作するときのwrapper\&quot;\ndescription: \&quot;fs-extraとpathを利用してよく使うパターンにまとめます。直接使うのも良いですが、デバッグ用のログを仕込んだりMockテストをすることを考えると一層間に噛ませると融通が効きます。\&quot;\nkeywords: \&quot;nodejs,filesystem\&quot;\ncreatedAt: 2019-06-12 22:59:00\nupdatedAt: 2019-06-12 22:59:00\n---\n\n## サンプルコード\n\n```typescript\n// filesystem.ts\nimport * as fs from \&quot;fs-extra\&quot;;\nimport * as path from \&quot;path\&quot;;\n\n/** ファイルがファイルとして存在するか. */\nexport const existFile = (filename: string) =&gt; {\n  return fs.existsSync(filename) &amp;&amp; fs.statSync(filename).isFile();\n};\n\n/** ディレクトリがディレクトリとして存在するか. */\nexport const existDirectory = (dirname: string) =&gt; {\n  return fs.existsSync(dirname) &amp;&amp; fs.statSync(dirname).isDirectory();\n};\n\n/** ディレクトリで在るかどうか. */\nconst isDirectory = (dirname: string) =&gt; {\n  return fs.existsSync(dirname) &amp;&amp; fs.statSync(dirname).isDirectory();\n};\n\n/** ディレクトリの作成.`mkdir -p`と同じ挙動をする. */\nexport const mkdirP = (dirPath: string) =&gt; {\n  if (!fs.existsSync(dirPath) || !fs.statSync(dirPath).isDirectory()) {\n    fs.mkdirSync(dirPath, { recursive: true });\n  }\n};\n\n/** テキストデータの同期的な保存. */\nexport const saveFile = (filename: string, data: string): void =&gt; {\n  fs.writeFileSync(filename, data, { encoding: \&quot;utf-8\&quot; });\n};\n\n/** JSON形式のデータの同期的な保存. */\nexport const saveJson = &lt;T&gt;(filename: string, config: T): void =&gt; {\n  try {\n    fs.writeFileSync(filename, JSON.stringify(config, null, 2), { encoding: \&quot;utf-8\&quot; });\n  } catch (e) {\n    console.error(e);\n  }\n};\n\n/** JSON形式のデータの同期的な読み込み. */\nexport const readJson = &lt;T&gt;(filename: string): T | undefined =&gt; {\n  if (!existFile(filename)) {\n    return;\n  }\n  try {\n    return JSON.parse(fs.readFileSync(filename, { encoding: \&quot;utf-8\&quot; }));\n  } catch (e) {\n    console.error(e);\n  }\n  return undefined;\n};\n\n/** 指定した拡張子の再帰的なファイルのコピー. */\nexport const copyFiles = (source: string, destination: string, extensions: string[]) =&gt; {\n  fs.copy(source, destination, {\n    filter: (targetPath: string) =&gt; {\n      return isDirectory(targetPath) || extensions.includes(path.extname(targetPath));\n    },\n    recursive: true,\n  });\n};\n```\n\n## 解説\n\nあくまで目的は**ローカル**でのファイル操作に焦点をあてた、ファイル操作のラッパーを提供することです。\n高速に処理することではなく、人間が理解できる処理内容になっていることを求めます。\n「人間が理解できる処理内容」を具体的に定義するならば、\n\n1. 同期的である\n   * 順序を整理しやすい\n2. 処理の対象が明確である\n   * `any`型がない\n3. 話し言葉に関数名が定義されている\n   * save, writeどっちかに寄せるなど\n4. デバッグしやすい状態\n   * ログを仕込みやすい\n5. コメントがある\n   * 言わずもがな\n\nこれらのことが満たされていると理解しやすくなります。\n\n## 参考\n\n* [jprichardson/node\\-fs\\-extra: Node\\.js: extra methods for the fs object like copy\\(\\), remove\\(\\), mkdirs\\(\\)](https://github.com/jprichardson/node-fs-extra)\n&quot;},&quot;site&quot;:{&quot;title&quot;:&quot;himenon.github.io&quot;,&quot;description&quot;:&quot;早く画面から出たい人の備忘録。&quot;,&quot;baseUri&quot;:&quot;/&quot;,&quot;baseUrl&quot;:&quot;https://himenon.github.io&quot;}}"></script>
  </head>

  <body>

    <body>
      <div>
        <nav id="nav-bar">
          <div id="nav-bar-container"><a href="/">TOP</a></div>
        </nav>
        <header id="site-header">
          <div id="site-header-container">
            <h1 id="page-title">NodeJSでローカルのファイルを操作するときのwrapper</h1>
            <p id="page-description">fs-extraとpathを利用してよく使うパターンにまとめます。直接使うのも良いですが、デバッグ用のログを仕込んだりMockテストをすることを考えると一層間に噛ませると融通が効きます。</p>
            <p id="article-time"><span id="posted-at__label">投稿日</span><time>2019-06-13 07:59:00</time><span id="created-at__label">更新日</span><time>2019-06-13 07:59:00</time></p>
          </div>
        </header>
      </div>
      <div class="wrapper">
        <section>
          <h2>サンプルコード</h2><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// filesystem.ts</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fs <span class="token keyword">from</span> <span class="token string">"fs-extra"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> path <span class="token keyword">from</span> <span class="token string">"path"</span><span class="token punctuation">;</span>

<span class="token comment">/** ファイルがファイルとして存在するか. */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">existFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">filename<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/** ディレクトリがディレクトリとして存在するか. */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">existDirectory</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dirname<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>dirname<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>dirname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/** ディレクトリで在るかどうか. */</span>
<span class="token keyword">const</span> <span class="token function-variable function">isDirectory</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dirname<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>dirname<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>dirname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/** ディレクトリの作成.`mkdir -p`と同じ挙動をする. */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">mkdirP</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dirPath<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">,</span> <span class="token punctuation">{</span> recursive<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/** テキストデータの同期的な保存. */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> saveFile <span class="token operator">=</span> <span class="token punctuation">(</span>filename<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token keyword">void</span></span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token punctuation">{</span> encoding<span class="token punctuation">:</span> <span class="token string">"utf-8"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/** JSON形式のデータの同期的な保存. */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> saveJson <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>filename<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token keyword">void</span></span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> encoding<span class="token punctuation">:</span> <span class="token string">"utf-8"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/** JSON形式のデータの同期的な読み込み. */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> readJson <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>filename<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token parameter">undefined</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">existFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token punctuation">{</span> encoding<span class="token punctuation">:</span> <span class="token string">"utf-8"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> undefined<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/** 指定した拡張子の再帰的なファイルのコピー. */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">copyFiles</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> destination<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> extensions<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> destination<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">filter</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">targetPath<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">isDirectory</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">)</span> <span class="token operator">||</span> extensions<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    recursive<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
          <h2>解説</h2>
          <p>あくまで目的は<strong>ローカル</strong>でのファイル操作に焦点をあてた、ファイル操作のラッパーを提供することです。
            高速に処理することではなく、人間が理解できる処理内容になっていることを求めます。
            「人間が理解できる処理内容」を具体的に定義するならば、</p>
          <ol>
            <li>同期的である<ul>
                <li>順序を整理しやすい</li>
              </ul>
            </li>
            <li>処理の対象が明確である<ul>
                <li><code>any</code>型がない</li>
              </ul>
            </li>
            <li>話し言葉に関数名が定義されている<ul>
                <li>save, writeどっちかに寄せるなど</li>
              </ul>
            </li>
            <li>デバッグしやすい状態<ul>
                <li>ログを仕込みやすい</li>
              </ul>
            </li>
            <li>コメントがある<ul>
                <li>言わずもがな</li>
              </ul>
            </li>
          </ol>
          <p>これらのことが満たされていると理解しやすくなります。</p>
          <h2>参考</h2>
          <ul>
            <li><a href="https://github.com/jprichardson/node-fs-extra">jprichardson/node-fs-extra: Node.js: extra methods for the fs object like copy(), remove(), mkdirs()</a></li>
          </ul>
        </section>
      </div>
    </body>
  </body>

</html>