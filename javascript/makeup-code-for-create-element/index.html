<html>

  <head lang="ja">
    <title>JavaScriptでHTMLを動的に生成するときの書き方の実践例</title>
    <meta charSet="utf-8" />
    <meta name="keywords" content="JavaScript,表示,書き方,例,サンプル,使い方,実用例" />
    <meta name="description" content="コーディングルールを決めた上でJavaScript内で動的にDOMを生成する実装をステップを踏んで紹介します。" />
    <meta name="copyright" content="@Himenon" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@Himenon" />
    <meta property="og:title" content="JavaScriptでHTMLを動的に生成するときの書き方の実践例" />
    <meta property="og:url" content="https://himenon.github.io/javascript/makeup-code-for-create-element" />
    <meta property="og:description" content="コーディングルールを決めた上でJavaScript内で動的にDOMを生成する実装をステップを踏んで紹介します。" />
    <meta property="og:image" content="https://himenon.github.io/assets/images/miku.png" />
    <meta name="viewport" content="initial-scale=1,minimum-scale=0.5,user-scalable=no" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/miku.png?832ec" />
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png?7afaf" />
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png?34b2b" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:600,800?e9782" rel="stylesheet" />
    <link href="/lib/prism.css?86537" rel="stylesheet" />
    <link href="/assets/stylesheets/styles.css?054f4" rel="stylesheet" />
    <script>
      (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
          m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
      })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'UA-55455343-7', 'auto');
      ga('send', 'pageview');
    </script>
    <script id="csr-props" data-csr-props="{&quot;htmlMetaData&quot;:{&quot;lang&quot;:&quot;ja&quot;,&quot;title&quot;:&quot;JavaScriptでHTMLを動的に生成するときの書き方の実践例&quot;,&quot;description&quot;:&quot;コーディングルールを決めた上でJavaScript内で動的にDOMを生成する実装をステップを踏んで紹介します。&quot;,&quot;keywords&quot;:&quot;JavaScript,表示,書き方,例,サンプル,使い方,実用例&quot;,&quot;copyright&quot;:&quot;@Himenon&quot;,&quot;viewport&quot;:{&quot;initial-scale&quot;:1,&quot;minimum-scale&quot;:0.5,&quot;user-scalable&quot;:&quot;no&quot;},&quot;thirdParty&quot;:{&quot;googleAnalytics&quot;:{&quot;ua&quot;:&quot;UA-55455343-7&quot;}},&quot;js&quot;:[],&quot;css&quot;:[&quot;https://fonts.googleapis.com/css?family=Open+Sans:600,800&quot;,&quot;./node_modules/prismjs/themes/prism.css&quot;,&quot;/assets/stylesheets/styles.css&quot;],&quot;link&quot;:[{&quot;rel&quot;:&quot;apple-touch-icon&quot;,&quot;sizes&quot;:&quot;180x180&quot;,&quot;href&quot;:&quot;assets/images/miku.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;32x32&quot;,&quot;href&quot;:&quot;assets/images/favicon-32x32.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;16x16&quot;,&quot;href&quot;:&quot;assets/images/favicon-16x16.png&quot;}],&quot;createdAt&quot;:&quot;2019-12-15T17:00:00.000Z&quot;,&quot;updatedAt&quot;:&quot;2019-12-16T17:00:00.000Z&quot;,&quot;globalScripts&quot;:[],&quot;globalLinks&quot;:[{&quot;rel&quot;:&quot;apple-touch-icon&quot;,&quot;sizes&quot;:&quot;180x180&quot;,&quot;href&quot;:&quot;/assets/images/miku.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;32x32&quot;,&quot;href&quot;:&quot;/assets/images/favicon-32x32.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;16x16&quot;,&quot;href&quot;:&quot;/assets/images/favicon-16x16.png&quot;},&quot;https://fonts.googleapis.com/css?family=Open+Sans:600,800&quot;,&quot;/lib/prism.css&quot;,&quot;/assets/stylesheets/styles.css&quot;],&quot;localLinks&quot;:[],&quot;extend&quot;:{&quot;meta&quot;:[{&quot;name&quot;:&quot;twitter:card&quot;,&quot;content&quot;:&quot;summary&quot;},{&quot;name&quot;:&quot;twitter:site&quot;,&quot;content&quot;:&quot;@Himenon&quot;},{&quot;property&quot;:&quot;og:title&quot;,&quot;content&quot;:&quot;JavaScriptでHTMLを動的に生成するときの書き方の実践例&quot;},{&quot;property&quot;:&quot;og:url&quot;,&quot;content&quot;:&quot;https://himenon.github.io/javascript/makeup-code-for-create-element&quot;},{&quot;property&quot;:&quot;og:description&quot;,&quot;content&quot;:&quot;コーディングルールを決めた上でJavaScript内で動的にDOMを生成する実装をステップを踏んで紹介します。&quot;},{&quot;property&quot;:&quot;og:image&quot;,&quot;content&quot;:&quot;https://himenon.github.io/assets/images/miku.png&quot;}]}},&quot;page&quot;:{&quot;uri&quot;:&quot;/javascript/makeup-code-for-create-element&quot;,&quot;content&quot;:&quot;\n2019年アドベントカレンダー ドワンゴの15日目の記事です。（過ぎてしまっていますが）\n\n[前日の記事](../blog/2019-12-14-jsconf2019-report)中でテクニカルな話が登場しなかったので、\n普段、自分がどのようにコードを書いているのかを紹介します。\n\n前提として、**プロダクション環境に持っていくコードで、自分以外の人間が保守する可能性のあるコード**を書くならどのように書くか、という視点で説明します。\n\n実行環境として、Google ChromeのDevToolsで動くコードを載せていきます。参考にTypeScriptの実装も載せます。\n\nいくつかのユースケースでどのように使うか紹介します。\n\n## 例題：ブログの情報からメニューを生成する\n\nたとえば本ブログもそうですが、「記事の一覧」を表示する機能を作りたい場合があります。\nゼロから作る場合、メニューに必要な情報に対して取得できる情報に過不足が生じている場合、最終出力までに変換を入れる必要があります。\n\n### 要件定義\n\n初期データとして以下のようなものを考えます。\n\n```js\nconst dataSet = [\n  {\n    title: \&quot;top\&quot;,\n    uri: \&quot;/top\&quot;,\n    description: \&quot;このwebサイトのTOPページ\&quot;,\n    tags: [\&quot;website\&quot;],\n  },\n  {\n    title: \&quot;about\&quot;,\n    uri: \&quot;/about\&quot;,\n    description: \&quot;このwebサイトの説明\&quot;,\n    tags: [\&quot;about\&quot;],\n  },\n  {\n    title: \&quot;blog\&quot;,\n    uri: \&quot;/blog\&quot;,\n    description: \&quot;ブログ一覧\&quot;,\n    tags: [\&quot;article\&quot;],\n  }\n];\n```\n\n出力としてほしいものは以下のようにします。\n\n```html\n&lt;ul&gt;\n  &lt;li&gt;&lt;a href=\&quot;https://example.com/top\&quot;&gt;top&lt;/a&gt;&lt;/li&gt;\n  &lt;li&gt;&lt;a href=\&quot;https://example.com/about\&quot;&gt;about&lt;/a&gt;&lt;/li&gt;\n  &lt;li&gt;&lt;a href=\&quot;https://example.com/blog\&quot;&gt;blog&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n```\n\n## 最短で書いた場合\n\n**取りあえず動く**ことを目標に書いたコードは以下のように書けます。\n\n```js\nconst ul = document.createElement(\&quot;ul\&quot;);\ndataSet.forEach(item =&gt; {\n  const li = document.createElement(\&quot;li\&quot;);\n  const anchor  = document.createElement(\&quot;a\&quot;);\n  anchor.text = item.title;\n  anchor.href = \&quot;https://example.com\&quot; + item.uri;\n  li.appendChild(anchor);\n  ul.appendChild(li);\n});\n\nul;\n```\n\nこれと比較して、本番環境に入れる場合のコードは次のように書いています。\n\n## 完成版\n\n```js\nconst createElement = ({ tagName, children }) =&gt; {\n  const element = document.createElement(tagName);\n  if (children) {\n    element.appendChild(children);\n  }\n  return element;\n}\n\nconst createFragment = ({ children }) =&gt; {\n  const fragment = document.createDocumentFragment()\n  children.forEach(child =&gt; {\n    fragment.appendChild(child);\n  });\n  return fragment;\n}\n\nconst createMenuItem = (props) =&gt; {\n  const anchor = createElement({ tagName: \&quot;a\&quot; });  \n  anchor.text = props.anchor.text;\n  anchor.href = props.anchor.href;\n  return createElement({ tagName: \&quot;li\&quot;, children: anchor });\n}\n\nconst createMenu = (props) =&gt; {\n  const menuItems = props.items.map(createMenuItem);\n  return createElement({ tagName: \&quot;ul\&quot;, children: createFragment(menuItems) });\n}\n\nconst generateMenuProps = (dataSet, baseUrl) =&gt; {\n  const items = dataSet.map(param =&gt; {\n    return {\n      anchor: {\n        text: param.title,\n        href: baseUrl + param.uri,\n      },\n    };\n  });\n  return { items };\n}\n\nconst menuProps = generateMenuProps(dataSet, \&quot;https://example.com\&quot;);\n\ncreateMenu(menuProps);\n```\n\n実装コードに大きな開きがあるのを見て取れます。\nなぜこのように冗長的なコードになるのか説明します。\n\n## 解説編\n\nまずは実装上のルールを以下のように定めています。\n\n### コーディングルール\n\n1. classの生成や、DOMの生成する、などNative APIを叩く関数は接頭辞に`create`を利用する\n2. データ変換をする関数の命名は以下のようにする\n   * `convertAtoB([Aのパラメーター])`\n     * 入力するAの型が確定している場合\n   * `generate[TargetName]([入力パラメーター])`\n     * 入力するパラメーターの型が\n       * 曖昧な場合\n       * 複数存在し、1つの意味で表現できない場合\n3. DOM生成の関数のパラメーター`props`と命名する\n   * propsはJavaScriptのObjectにする\n   * props内のキー名はpropsを利用する関数が必要とするパラメーター名にする\n   * propsの少勇者は生成する対象自身とする\n4. 同一スコープ内で命名がかぶる場合は、関数名に具象度が1つ高い名前を含める\n   * スコープ内で衝突が起きなくなるまでこれを繰り返す\n5. 関数を以下の方針で分割する\n   * 意味のある単位\n     * 意味 ≒ 要件\n   * 同じ実装が複数回繰り返された場合\n   * Mock/Stubテストが必要となりそうなAPIを直接叩いている場合\n\nそれでは、最短で書いた場合のコードを見つつ、ルールを適用します。\nルールをコードに適用していく際、どのようにしていくかはある程度の慣れが必要ですので、\n手を動かして検証してみてください。\n\n### Step 1：意味のある単位で分割する\n\n最初に着手するのは要件からです。\nわかりやすのは表示の部分で、最終出力は`ul &gt; li &gt; a`という構造を持っています。\nタグだけは意味が伝わらないので、命名をします。\n\n```\nMenuItem : li &gt; a のHTMLElement\nMenu     : ul &gt; MenuItem のHTMLElement\n```\n\nこれにより、`MenuItem`と`Menu`を生成する必要があります。\n返り値は`HTMLElement`であるため、[`document.createElement`](https://developer.mozilla.org/ja/docs/Web/API/Document/createElement)を利用することになります。\nこれにより、次のように命名が確定します。\n\n```js\n// document.createElementはNative APIであるため、接頭辞に`create`を採用\n// create + HTMLElement(生成対象)\nconst createHTMLElement = () =&gt; {}\n// MenuとMenuItemで名前が衝突するため、具象度を上げる\nconst createMenuItem = () =&gt; {}\nconst createMenu = () =&gt; {}\n```\n\nこれで骨格が整いました。骨格だけで実装すると、次のようになります。\n\n```js\nconst createMenuItem = () =&gt; {\n  const li = document.createElement(\&quot;li\&quot;);\n  const anchor = document.createElement(\&quot;a\&quot;);\n  li.appendChild(anchor);\n  return li;\n}\n\nconst createMenu = () =&gt; {\n  const ul = document.createElement(\&quot;ul\&quot;);\n  // menuItemをループで生成\n  // ul.appendChild(menuItem);\n  return ul;\n}\n\ncreateMenu();\n```\n\n返り値の命名は`create[生成対象]`のうち、`生成対象`をcamelCaseにすると衝突しにくくなります。\nただ、今回は`document.createElement`を挟んでいるので、ここは生成するタグ名を利用しました。\n\n```js\n// 生成対象は引数に合致するため、変数名は`ul`となる\n// https://developer.mozilla.org/ja/docs/Web/API/HTMLAnchorElement\nconst ul = document.createElement(\&quot;ul\&quot;);\n// `create + [生成対象]`の公式に当てはめられるため、変数名は`menuItem`となる\nconst menuItem = createMenuItem();\n```\n\n余談：ちなみに、`a`タグ生成時の変数名は`a`ではないかというと、Web APIは`HTMLAnchorElement`から命名を引っ張ってきているためです。\nTypeScriptであれば、`React`の型定義を参照してみるのも良いでしょう。\n\n参考\n\n* HTMLAnchorElement\n  * https://developer.mozilla.org/ja/docs/Web/API/HTMLAnchorElement\n* `@types/react`\n  * https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/react/global.d.ts#L32\n  * https://github.com/DefinitelyTyped/DefinitelyTyped/blob/288692b272b695eda00a47f93339e1e16ee756b1/types/react/index.d.ts#L2863-L3043\n\n### Step 2：引数を決定する\n\n`createMenu`と`createMenuItem`引数の名前をまずは決めましょう。\n今回は`document.createElement`で生成したDOMに対してパラメーターを渡すため、`props`という変数名になります。\n\n```js\nconst createMenuItem = (props) =&gt; {}\nconst createMenu = (props) =&gt; {}\n```\n\n次に、`props`（Object）の中身を決定します。\nキー名は生成するHTMLElementの名前を入れるのが良いでしょう。\n\n```js\nconst createMenuItem = (props) =&gt; {\n  // props = { anchor: {} };\n}\nconst createMenu = (props) =&gt; {\n  // props = { items: [ { anchor: { ... } }, { anchor: { ... } } ] }\n}\n```\n\nここで不思議だと思うのが、`createMenu`のpropsの名前が`props.menuItems`ではないことでしょう。\n実はこれルールにも書きましたが、`props`の所有者は生成対象、つまり`menu`だと考えると\n`menu.items`と読み変えることができます。これにより要件が増えた場合でも柔軟に対応できる構造を表現できます。\n\nここまでを実装に落とすと、\n\n```js\nconst createMenuItem = (props) =&gt; {\n  const li = document.createElement(\&quot;li\&quot;);\n  const anchor = document.createElement(\&quot;a\&quot;);\n  anchor.text = props.anchor.text;\n  anchor.href = props.anchor.href;\n  li.appendChild(anchor);\n  return li;\n}\n\nconst createMenu = (props) =&gt; {\n  const ul = document.createElement(\&quot;ul\&quot;);\n  props.items.forEach(item =&gt; {\n    const menuItem = createMenuItem(item);\n    ul.appendChild(menuItem);\n  });\n  return ul;\n}\n\ncreateMenu(/** Step3へ */);\n```\n\nと書くことができます。\n\n### Step 3：与えられたデータを変換する\n\nStep2までではまだ実装が不十分です。`dataSet`に対して`createMenu`の引数の型が合致していません。\nそのため変換が必要となります。\n\nまた、dataSetにはベースURLが存在しないため、追加する実装も必要です。\n最短の実装では次のように書いていた部分です。\n\n```js\nanchor.href = \&quot;https://example.com\&quot; + item.uri;\n```\n\nつまり、`dataSet`とベースURL`https://example.com`を利用して、`createMenu`にわたす変数を生成する関数を定義します。\n\n関数は`convertAtoB`形式か`generate[TargetName]`のどちらかになりますが、\n`convertAtoB`を採用する場合は入力する側のパラメーターが意味のある形でまとまっていなければ`A`を命名することができません。つまり、今回の場合、`dataSet`とベースURLの塊に命名ができれば利用できますが、**具体的な**名前が簡単には思いつかないので、`generate[TargetName]`形式の命名を行います。\n\n生成対象は`createMenu`の入力変数、つまり、`Menu`の`props` -&gt; `MenuProps`になります。\nゆえに、\n\n```js\nconst generateMenuProps = () =&gt; {}\n```\n\nと関数名が決定されます。この関数の引数は`Menu`の`Props`を生成に必要な素材を渡すだけです。\n\n```js\nconst generateMenuProps = (dataSet, baseUrl) =&gt; {}\n```\n\nここまで来たら後は変換する実装コードを書くだけになります。\n\n```js\nconst generateMenuProps = (dataSet, baseUrl) =&gt; {\n  const items = dataSet.map(param =&gt; {\n    return {\n      anchor: {\n        text: param.title,\n        href: baseUrl + param.uri,\n      },\n    };\n  });\n  return { items };\n}\n```\n\nこれで完成です。結合してみると、\n\n```js\nconst createMenuItem = (props) =&gt; {\n  const li = document.createElement(\&quot;li\&quot;);\n  const anchor = document.createElement(\&quot;a\&quot;);\n  anchor.text = props.anchor.text;\n  anchor.href = props.anchor.href;\n  li.appendChild(anchor);\n  return li;\n}\n\nconst createMenu = (props) =&gt; {\n  const ul = document.createElement(\&quot;ul\&quot;);\n  props.items.forEach(item =&gt; {\n    const menuItem = createMenuItem(item);\n    ul.appendChild(menuItem);\n  });\n  return ul;\n}\n\nconst generateMenuProps = (dataSet, baseUrl) =&gt; {\n  const items = dataSet.map(param =&gt; {\n    return {\n      anchor: {\n        text: param.title,\n        href: baseUrl + param.uri,\n      },\n    };\n  });\n  return { items };\n}\n\nconst menuProps = generateMenuProps(dataSet, \&quot;http://example.com\&quot;);\n\ncreateMenu(menuProps);\n```\n\nほとんどこれで完成と言っても問題ないでしょう。\nStep 4移行は体裁を整えてい作業を行います。\n\n### Step 4：関数をまとめる\n\nまずやることは関数の分割です。同じような実装を少しだけ抽象化して、まとめていきます。\n目にとまるのは、`document.createElement`の部分です。\n\n```js\nconst li = document.createElement(\&quot;li\&quot;);\nli.appendChild(/** Children */);\n```\n\nこのような組み合わせが散見されます。`appendChild`を利用しない場合もあるので、分岐が必要です。\nDOMを生成する関数を定義する場合、`props`という引数を定義しますが、今回はもう少し簡潔に書いてみましょう。\n`createElement`という関数を新たに作り、「指定されたタグのHTMLElementを生成し、子要素を追加する」処理を与えましょう。\n\n```js\nconst createElement = ({ tagName, children }) =&gt; {\n  const element = document.createElement(tagName);\n  if (children) {\n    element.appendChild(children);\n  }\n  return element;\n}\n```\n\n名前の衝突がない場合、[分割代入](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment)を行うと\n冗長な書き方が避けられます。\n\n```js\nconst { tagName, children } = props; // 分割代入\n```\n\n新しく定義した`createElement`を利用すると、\n\n```js\nconst createElement = ({ tagName, children }) =&gt; {\n  const element = document.createElement(tagName);\n  if (children) {\n    element.appendChild(children);\n  }\n  return element;\n}\n\nconst createMenuItem = (props) =&gt; {\n  const anchor = createElement({ tagName: \&quot;a\&quot; });  \n  anchor.text = props.anchor.text;\n  anchor.href = props.anchor.href;\n  return createElement({ tagName: \&quot;li\&quot;, children: anchor });\n}\n\nconst createMenu = (props) =&gt; {\n  const ul = createElement({ tagName: \&quot;ul\&quot; });\n  props.items.forEach(item =&gt; {\n    const menuItem = createMenuItem(item);\n    ul.appendChild(menuItem);\n  });\n  return ul;\n}\n\nconst generateMenuProps = (dataSet, baseUrl) =&gt; {\n  const items = dataSet.map(param =&gt; {\n    return {\n      anchor: {\n        text: param.title,\n        href: baseUrl + param.uri,\n      },\n    };\n  });\n  return { items };\n}\n\nconst menuProps = generateMenuProps(dataSet, \&quot;https://example.com\&quot;);\n\ncreateMenu(menuProps);\n```\n\nとなります。\n`createMenu`を見ていると`createElement`で生成された`ul`は後から`appendChild`でElementを追加しています。これは技術的に2点、実装の思想として1点で注意する点があります。\n\n技術的には\n\n1. `HTMLElement`に`NodeList`をそのまま`appendChild`できない\n2. `appendChild`を都度行う場合パフォーマン的を下げるパターンがある\n\n実装の思想的には\n\n1. `createElement`は「子要素を追加する」処理を含む形で実装したがカバーできていない。\n\n技術的な解消方法はシンプルです。\nHTMLElementの配列（下記）を直接`appendChild`することができません。\nこれを行うには、[DocumentFragment](https://developer.mozilla.org/ja/docs/Web/API/DocumentFragment)の形式に変換した上で`appendChild`に渡す必要があります。\n\n```js\n// HTMLElementの配列の例\n[\n  &lt;li&gt;&lt;a&gt;...&lt;/a&gt;&lt;/li&gt;, // createMenuで生成したHTMLElement\n  &lt;li&gt;&lt;a&gt;...&lt;/a&gt;&lt;/li&gt;, // createMenuで生成したHTMLElement\n  &lt;li&gt;&lt;a&gt;...&lt;/a&gt;&lt;/li&gt;, // createMenuで生成したHTMLElement\n]\n```\n\nDocumentFragmentを生成するには`document.createDocumentFragment`を利用します。\n`document.createElement`と同じように扱うことができるので、`createElement`と似たようなラッパー関数を定義します。\n\n```js\nconst createFragment = ({ children }) =&gt; {\n  const fragment = document.createDocumentFragment()\n  children.forEach(child =&gt; {\n    fragment.appendChild(child);\n  });\n  return fragment;\n}\n```\n\nこれを採用すると`createMenu`は次のようにかけます。\n\n```js\nconst createMenu = (props) =&gt; {\n  const menuItems = props.items.map(createMenuItem);\n  return createElement({\n    tagName: \&quot;ul\&quot;,\n    children: createFragment(menuItems) // fragment化して渡すことでappendChildを消せた\n  });\n}\n```\n\nこれで最初に提示した**完成版**へたどり着くことができました。\n\n**参考**\n\n* DocumentFragment&lt;br /&gt;https://developer.mozilla.org/ja/docs/Web/API/DocumentFragment\n* JavaScript 大量の要素をDOMに追加する際の、createDocumentFragmentの使い方。&lt;br /&gt;https://qiita.com/39_isao/items/2fa8faed283d455f4181\n* 七章第四回　ノードをまとめて扱う：DocumentFragment&lt;br /&gt;https://uhyohyo.net/javascript/7_4.html\n\n### Step 5：応用編\n\nここまで読んでくれた方にもう少し発展系を提示します。\n**完成版**ですが、もう少し手を加えると以下のようなことができます。\n\n* `createElement`に`createFragment`を含める\n* `anchor.text =` / `anchor.href` を`createElement`の引数として渡す\n\nこれを行うことで、`createElement`がより抽象化され、`createMenu`、`createMenuItem`をシンプルに書くことができます。\n下記にそれを記すので、自分でチャレンジしたい方はまだスクロールをここで止めてください。\n\n変更した関数だけ以下に記述します。\n\n```js\nconst createElement = ({ tagName, children, ...props }) =&gt; {\n  const element = document.createElement(tagName);\n  // propsは`tagName`, `children`を除いたパラメータを受け取ることを利用し、\n  // createElementの残りのkeyを生成するHTMLElementのプロパティのキーとして利用する\n  Object.entries(props).forEach(([key, value]) =&gt; {\n    element[key] = value;\n  });\n  if (children) {\n    // 配列の場合はcreateFragmentを通す\n    element.appendChild(Array.isArray(children) ? createFragment({ children }) : children);\n  }\n  return element;\n}\n\nconst createMenuItem = (props) =&gt; {\n  return createElement({\n    tagName: \&quot;li\&quot;,\n    children: createElement({ tagName: \&quot;a\&quot;, ...props.anchor }),\n  });\n}\n\nconst createMenu = (props) =&gt; {\n  return createElement({\n    tagName: \&quot;ul\&quot;,\n    children: props.items.map(createMenuItem), // childrenは配列も受け取ることができる\n  });\n}\n```\n\nこれにより、`createMenu`と`createMenuItem`が`createElement`だけで表現できるようになりました。\n\nStep5の実装コードは[こちら](https://gist.github.com/Himenon/d1cea3447b88a9248c82d82dcac1241b)。\n\n## まとめ\n\n* 要件に対する最短のコーディングを提示し、**プロダクション環境に持っていくコードで、自分以外の人間が保守する可能性のあるコード**を前提としたリファクタリングを行いました。\n* コーディングルールを決めておくことで、命名が自動的に決定されることを紹介しました。\n\n## 最後に \n\n実は、`createElement`の引数や構造化はReactの`React.createElement`あたりを意識しつつ作っています。\nJSXを利用してReactを見ていると今回のような`createElement`はなかなか目にしませんが、本質的には近い処理を行っています。\nまた、Reactの管理下にあると、DOMの差分変更を行えたりより多くの恩恵を受けることができます。\nとはいえ、これは`createElement`を深掘って行ったときの話です。\n今回の本題はコーディングを勧めていく上の考え方を紹介することにあります。\nある程度のコーディングルールを決めておくことで命名や構造化はほとんどの場合、要件を固めた時点で確定します。\n本記事でその一端でもつかめると書いた甲斐があったなぁと思います。\n\n2019年も残すところ僅かです。みなさんんおより良い開発を願ってます！\n\nそれでは！\n&quot;,&quot;metaData&quot;:{&quot;lang&quot;:&quot;ja&quot;,&quot;title&quot;:&quot;JavaScriptでHTMLを動的に生成するときの書き方の実践例&quot;,&quot;description&quot;:&quot;コーディングルールを決めた上でJavaScript内で動的にDOMを生成する実装をステップを踏んで紹介します。&quot;,&quot;keywords&quot;:&quot;JavaScript,表示,書き方,例,サンプル,使い方,実用例&quot;,&quot;copyright&quot;:&quot;@Himenon&quot;,&quot;viewport&quot;:{&quot;initial-scale&quot;:1,&quot;minimum-scale&quot;:0.5,&quot;user-scalable&quot;:&quot;no&quot;},&quot;thirdParty&quot;:{&quot;googleAnalytics&quot;:{&quot;ua&quot;:&quot;UA-55455343-7&quot;}},&quot;js&quot;:[],&quot;css&quot;:[&quot;https://fonts.googleapis.com/css?family=Open+Sans:600,800&quot;,&quot;./node_modules/prismjs/themes/prism.css&quot;,&quot;/assets/stylesheets/styles.css&quot;],&quot;link&quot;:[{&quot;rel&quot;:&quot;apple-touch-icon&quot;,&quot;sizes&quot;:&quot;180x180&quot;,&quot;href&quot;:&quot;assets/images/miku.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;32x32&quot;,&quot;href&quot;:&quot;assets/images/favicon-32x32.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;16x16&quot;,&quot;href&quot;:&quot;assets/images/favicon-16x16.png&quot;}],&quot;createdAt&quot;:&quot;2019-12-15T17:00:00.000Z&quot;,&quot;updatedAt&quot;:&quot;2019-12-16T17:00:00.000Z&quot;,&quot;globalScripts&quot;:[],&quot;globalLinks&quot;:[{&quot;rel&quot;:&quot;apple-touch-icon&quot;,&quot;sizes&quot;:&quot;180x180&quot;,&quot;href&quot;:&quot;/assets/images/miku.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;32x32&quot;,&quot;href&quot;:&quot;/assets/images/favicon-32x32.png&quot;},{&quot;rel&quot;:&quot;icon&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;sizes&quot;:&quot;16x16&quot;,&quot;href&quot;:&quot;/assets/images/favicon-16x16.png&quot;},&quot;https://fonts.googleapis.com/css?family=Open+Sans:600,800&quot;,&quot;/lib/prism.css&quot;,&quot;/assets/stylesheets/styles.css&quot;],&quot;localLinks&quot;:[],&quot;extend&quot;:{&quot;meta&quot;:[{&quot;name&quot;:&quot;twitter:card&quot;,&quot;content&quot;:&quot;summary&quot;},{&quot;name&quot;:&quot;twitter:site&quot;,&quot;content&quot;:&quot;@Himenon&quot;},{&quot;property&quot;:&quot;og:title&quot;,&quot;content&quot;:&quot;JavaScriptでHTMLを動的に生成するときの書き方の実践例&quot;},{&quot;property&quot;:&quot;og:url&quot;,&quot;content&quot;:&quot;https://himenon.github.io/javascript/makeup-code-for-create-element&quot;},{&quot;property&quot;:&quot;og:description&quot;,&quot;content&quot;:&quot;コーディングルールを決めた上でJavaScript内で動的にDOMを生成する実装をステップを踏んで紹介します。&quot;},{&quot;property&quot;:&quot;og:image&quot;,&quot;content&quot;:&quot;https://himenon.github.io/assets/images/miku.png&quot;}]}},&quot;ext&quot;:&quot;.md&quot;,&quot;filename&quot;:&quot;src/javascript/makeup-code-for-create-element.md&quot;,&quot;name&quot;:&quot;javascript/makeup-code-for-create-element&quot;,&quot;raw&quot;:&quot;---\ntitle: \&quot;JavaScriptでHTMLを動的に生成するときの書き方の実践例\&quot;\ndescription: \&quot;コーディングルールを決めた上でJavaScript内で動的にDOMを生成する実装をステップを踏んで紹介します。\&quot;\nkeywords: \&quot;JavaScript,表示,書き方,例,サンプル,使い方,実用例\&quot;\ncreatedAt: 2019-12-15 17:00:00\nupdatedAt: 2019-12-16 17:00:00\n---\n\n2019年アドベントカレンダー ドワンゴの15日目の記事です。（過ぎてしまっていますが）\n\n[前日の記事](../blog/2019-12-14-jsconf2019-report)中でテクニカルな話が登場しなかったので、\n普段、自分がどのようにコードを書いているのかを紹介します。\n\n前提として、**プロダクション環境に持っていくコードで、自分以外の人間が保守する可能性のあるコード**を書くならどのように書くか、という視点で説明します。\n\n実行環境として、Google ChromeのDevToolsで動くコードを載せていきます。参考にTypeScriptの実装も載せます。\n\nいくつかのユースケースでどのように使うか紹介します。\n\n## 例題：ブログの情報からメニューを生成する\n\nたとえば本ブログもそうですが、「記事の一覧」を表示する機能を作りたい場合があります。\nゼロから作る場合、メニューに必要な情報に対して取得できる情報に過不足が生じている場合、最終出力までに変換を入れる必要があります。\n\n### 要件定義\n\n初期データとして以下のようなものを考えます。\n\n```js\nconst dataSet = [\n  {\n    title: \&quot;top\&quot;,\n    uri: \&quot;/top\&quot;,\n    description: \&quot;このwebサイトのTOPページ\&quot;,\n    tags: [\&quot;website\&quot;],\n  },\n  {\n    title: \&quot;about\&quot;,\n    uri: \&quot;/about\&quot;,\n    description: \&quot;このwebサイトの説明\&quot;,\n    tags: [\&quot;about\&quot;],\n  },\n  {\n    title: \&quot;blog\&quot;,\n    uri: \&quot;/blog\&quot;,\n    description: \&quot;ブログ一覧\&quot;,\n    tags: [\&quot;article\&quot;],\n  }\n];\n```\n\n出力としてほしいものは以下のようにします。\n\n```html\n&lt;ul&gt;\n  &lt;li&gt;&lt;a href=\&quot;https://example.com/top\&quot;&gt;top&lt;/a&gt;&lt;/li&gt;\n  &lt;li&gt;&lt;a href=\&quot;https://example.com/about\&quot;&gt;about&lt;/a&gt;&lt;/li&gt;\n  &lt;li&gt;&lt;a href=\&quot;https://example.com/blog\&quot;&gt;blog&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n```\n\n## 最短で書いた場合\n\n**取りあえず動く**ことを目標に書いたコードは以下のように書けます。\n\n```js\nconst ul = document.createElement(\&quot;ul\&quot;);\ndataSet.forEach(item =&gt; {\n  const li = document.createElement(\&quot;li\&quot;);\n  const anchor  = document.createElement(\&quot;a\&quot;);\n  anchor.text = item.title;\n  anchor.href = \&quot;https://example.com\&quot; + item.uri;\n  li.appendChild(anchor);\n  ul.appendChild(li);\n});\n\nul;\n```\n\nこれと比較して、本番環境に入れる場合のコードは次のように書いています。\n\n## 完成版\n\n```js\nconst createElement = ({ tagName, children }) =&gt; {\n  const element = document.createElement(tagName);\n  if (children) {\n    element.appendChild(children);\n  }\n  return element;\n}\n\nconst createFragment = ({ children }) =&gt; {\n  const fragment = document.createDocumentFragment()\n  children.forEach(child =&gt; {\n    fragment.appendChild(child);\n  });\n  return fragment;\n}\n\nconst createMenuItem = (props) =&gt; {\n  const anchor = createElement({ tagName: \&quot;a\&quot; });  \n  anchor.text = props.anchor.text;\n  anchor.href = props.anchor.href;\n  return createElement({ tagName: \&quot;li\&quot;, children: anchor });\n}\n\nconst createMenu = (props) =&gt; {\n  const menuItems = props.items.map(createMenuItem);\n  return createElement({ tagName: \&quot;ul\&quot;, children: createFragment(menuItems) });\n}\n\nconst generateMenuProps = (dataSet, baseUrl) =&gt; {\n  const items = dataSet.map(param =&gt; {\n    return {\n      anchor: {\n        text: param.title,\n        href: baseUrl + param.uri,\n      },\n    };\n  });\n  return { items };\n}\n\nconst menuProps = generateMenuProps(dataSet, \&quot;https://example.com\&quot;);\n\ncreateMenu(menuProps);\n```\n\n実装コードに大きな開きがあるのを見て取れます。\nなぜこのように冗長的なコードになるのか説明します。\n\n## 解説編\n\nまずは実装上のルールを以下のように定めています。\n\n### コーディングルール\n\n1. classの生成や、DOMの生成する、などNative APIを叩く関数は接頭辞に`create`を利用する\n2. データ変換をする関数の命名は以下のようにする\n   * `convertAtoB([Aのパラメーター])`\n     * 入力するAの型が確定している場合\n   * `generate[TargetName]([入力パラメーター])`\n     * 入力するパラメーターの型が\n       * 曖昧な場合\n       * 複数存在し、1つの意味で表現できない場合\n3. DOM生成の関数のパラメーター`props`と命名する\n   * propsはJavaScriptのObjectにする\n   * props内のキー名はpropsを利用する関数が必要とするパラメーター名にする\n   * propsの少勇者は生成する対象自身とする\n4. 同一スコープ内で命名がかぶる場合は、関数名に具象度が1つ高い名前を含める\n   * スコープ内で衝突が起きなくなるまでこれを繰り返す\n5. 関数を以下の方針で分割する\n   * 意味のある単位\n     * 意味 ≒ 要件\n   * 同じ実装が複数回繰り返された場合\n   * Mock/Stubテストが必要となりそうなAPIを直接叩いている場合\n\nそれでは、最短で書いた場合のコードを見つつ、ルールを適用します。\nルールをコードに適用していく際、どのようにしていくかはある程度の慣れが必要ですので、\n手を動かして検証してみてください。\n\n### Step 1：意味のある単位で分割する\n\n最初に着手するのは要件からです。\nわかりやすのは表示の部分で、最終出力は`ul &gt; li &gt; a`という構造を持っています。\nタグだけは意味が伝わらないので、命名をします。\n\n```\nMenuItem : li &gt; a のHTMLElement\nMenu     : ul &gt; MenuItem のHTMLElement\n```\n\nこれにより、`MenuItem`と`Menu`を生成する必要があります。\n返り値は`HTMLElement`であるため、[`document.createElement`](https://developer.mozilla.org/ja/docs/Web/API/Document/createElement)を利用することになります。\nこれにより、次のように命名が確定します。\n\n```js\n// document.createElementはNative APIであるため、接頭辞に`create`を採用\n// create + HTMLElement(生成対象)\nconst createHTMLElement = () =&gt; {}\n// MenuとMenuItemで名前が衝突するため、具象度を上げる\nconst createMenuItem = () =&gt; {}\nconst createMenu = () =&gt; {}\n```\n\nこれで骨格が整いました。骨格だけで実装すると、次のようになります。\n\n```js\nconst createMenuItem = () =&gt; {\n  const li = document.createElement(\&quot;li\&quot;);\n  const anchor = document.createElement(\&quot;a\&quot;);\n  li.appendChild(anchor);\n  return li;\n}\n\nconst createMenu = () =&gt; {\n  const ul = document.createElement(\&quot;ul\&quot;);\n  // menuItemをループで生成\n  // ul.appendChild(menuItem);\n  return ul;\n}\n\ncreateMenu();\n```\n\n返り値の命名は`create[生成対象]`のうち、`生成対象`をcamelCaseにすると衝突しにくくなります。\nただ、今回は`document.createElement`を挟んでいるので、ここは生成するタグ名を利用しました。\n\n```js\n// 生成対象は引数に合致するため、変数名は`ul`となる\n// https://developer.mozilla.org/ja/docs/Web/API/HTMLAnchorElement\nconst ul = document.createElement(\&quot;ul\&quot;);\n// `create + [生成対象]`の公式に当てはめられるため、変数名は`menuItem`となる\nconst menuItem = createMenuItem();\n```\n\n余談：ちなみに、`a`タグ生成時の変数名は`a`ではないかというと、Web APIは`HTMLAnchorElement`から命名を引っ張ってきているためです。\nTypeScriptであれば、`React`の型定義を参照してみるのも良いでしょう。\n\n参考\n\n* HTMLAnchorElement\n  * https://developer.mozilla.org/ja/docs/Web/API/HTMLAnchorElement\n* `@types/react`\n  * https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/react/global.d.ts#L32\n  * https://github.com/DefinitelyTyped/DefinitelyTyped/blob/288692b272b695eda00a47f93339e1e16ee756b1/types/react/index.d.ts#L2863-L3043\n\n### Step 2：引数を決定する\n\n`createMenu`と`createMenuItem`引数の名前をまずは決めましょう。\n今回は`document.createElement`で生成したDOMに対してパラメーターを渡すため、`props`という変数名になります。\n\n```js\nconst createMenuItem = (props) =&gt; {}\nconst createMenu = (props) =&gt; {}\n```\n\n次に、`props`（Object）の中身を決定します。\nキー名は生成するHTMLElementの名前を入れるのが良いでしょう。\n\n```js\nconst createMenuItem = (props) =&gt; {\n  // props = { anchor: {} };\n}\nconst createMenu = (props) =&gt; {\n  // props = { items: [ { anchor: { ... } }, { anchor: { ... } } ] }\n}\n```\n\nここで不思議だと思うのが、`createMenu`のpropsの名前が`props.menuItems`ではないことでしょう。\n実はこれルールにも書きましたが、`props`の所有者は生成対象、つまり`menu`だと考えると\n`menu.items`と読み変えることができます。これにより要件が増えた場合でも柔軟に対応できる構造を表現できます。\n\nここまでを実装に落とすと、\n\n```js\nconst createMenuItem = (props) =&gt; {\n  const li = document.createElement(\&quot;li\&quot;);\n  const anchor = document.createElement(\&quot;a\&quot;);\n  anchor.text = props.anchor.text;\n  anchor.href = props.anchor.href;\n  li.appendChild(anchor);\n  return li;\n}\n\nconst createMenu = (props) =&gt; {\n  const ul = document.createElement(\&quot;ul\&quot;);\n  props.items.forEach(item =&gt; {\n    const menuItem = createMenuItem(item);\n    ul.appendChild(menuItem);\n  });\n  return ul;\n}\n\ncreateMenu(/** Step3へ */);\n```\n\nと書くことができます。\n\n### Step 3：与えられたデータを変換する\n\nStep2までではまだ実装が不十分です。`dataSet`に対して`createMenu`の引数の型が合致していません。\nそのため変換が必要となります。\n\nまた、dataSetにはベースURLが存在しないため、追加する実装も必要です。\n最短の実装では次のように書いていた部分です。\n\n```js\nanchor.href = \&quot;https://example.com\&quot; + item.uri;\n```\n\nつまり、`dataSet`とベースURL`https://example.com`を利用して、`createMenu`にわたす変数を生成する関数を定義します。\n\n関数は`convertAtoB`形式か`generate[TargetName]`のどちらかになりますが、\n`convertAtoB`を採用する場合は入力する側のパラメーターが意味のある形でまとまっていなければ`A`を命名することができません。つまり、今回の場合、`dataSet`とベースURLの塊に命名ができれば利用できますが、**具体的な**名前が簡単には思いつかないので、`generate[TargetName]`形式の命名を行います。\n\n生成対象は`createMenu`の入力変数、つまり、`Menu`の`props` -&gt; `MenuProps`になります。\nゆえに、\n\n```js\nconst generateMenuProps = () =&gt; {}\n```\n\nと関数名が決定されます。この関数の引数は`Menu`の`Props`を生成に必要な素材を渡すだけです。\n\n```js\nconst generateMenuProps = (dataSet, baseUrl) =&gt; {}\n```\n\nここまで来たら後は変換する実装コードを書くだけになります。\n\n```js\nconst generateMenuProps = (dataSet, baseUrl) =&gt; {\n  const items = dataSet.map(param =&gt; {\n    return {\n      anchor: {\n        text: param.title,\n        href: baseUrl + param.uri,\n      },\n    };\n  });\n  return { items };\n}\n```\n\nこれで完成です。結合してみると、\n\n```js\nconst createMenuItem = (props) =&gt; {\n  const li = document.createElement(\&quot;li\&quot;);\n  const anchor = document.createElement(\&quot;a\&quot;);\n  anchor.text = props.anchor.text;\n  anchor.href = props.anchor.href;\n  li.appendChild(anchor);\n  return li;\n}\n\nconst createMenu = (props) =&gt; {\n  const ul = document.createElement(\&quot;ul\&quot;);\n  props.items.forEach(item =&gt; {\n    const menuItem = createMenuItem(item);\n    ul.appendChild(menuItem);\n  });\n  return ul;\n}\n\nconst generateMenuProps = (dataSet, baseUrl) =&gt; {\n  const items = dataSet.map(param =&gt; {\n    return {\n      anchor: {\n        text: param.title,\n        href: baseUrl + param.uri,\n      },\n    };\n  });\n  return { items };\n}\n\nconst menuProps = generateMenuProps(dataSet, \&quot;http://example.com\&quot;);\n\ncreateMenu(menuProps);\n```\n\nほとんどこれで完成と言っても問題ないでしょう。\nStep 4移行は体裁を整えてい作業を行います。\n\n### Step 4：関数をまとめる\n\nまずやることは関数の分割です。同じような実装を少しだけ抽象化して、まとめていきます。\n目にとまるのは、`document.createElement`の部分です。\n\n```js\nconst li = document.createElement(\&quot;li\&quot;);\nli.appendChild(/** Children */);\n```\n\nこのような組み合わせが散見されます。`appendChild`を利用しない場合もあるので、分岐が必要です。\nDOMを生成する関数を定義する場合、`props`という引数を定義しますが、今回はもう少し簡潔に書いてみましょう。\n`createElement`という関数を新たに作り、「指定されたタグのHTMLElementを生成し、子要素を追加する」処理を与えましょう。\n\n```js\nconst createElement = ({ tagName, children }) =&gt; {\n  const element = document.createElement(tagName);\n  if (children) {\n    element.appendChild(children);\n  }\n  return element;\n}\n```\n\n名前の衝突がない場合、[分割代入](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment)を行うと\n冗長な書き方が避けられます。\n\n```js\nconst { tagName, children } = props; // 分割代入\n```\n\n新しく定義した`createElement`を利用すると、\n\n```js\nconst createElement = ({ tagName, children }) =&gt; {\n  const element = document.createElement(tagName);\n  if (children) {\n    element.appendChild(children);\n  }\n  return element;\n}\n\nconst createMenuItem = (props) =&gt; {\n  const anchor = createElement({ tagName: \&quot;a\&quot; });  \n  anchor.text = props.anchor.text;\n  anchor.href = props.anchor.href;\n  return createElement({ tagName: \&quot;li\&quot;, children: anchor });\n}\n\nconst createMenu = (props) =&gt; {\n  const ul = createElement({ tagName: \&quot;ul\&quot; });\n  props.items.forEach(item =&gt; {\n    const menuItem = createMenuItem(item);\n    ul.appendChild(menuItem);\n  });\n  return ul;\n}\n\nconst generateMenuProps = (dataSet, baseUrl) =&gt; {\n  const items = dataSet.map(param =&gt; {\n    return {\n      anchor: {\n        text: param.title,\n        href: baseUrl + param.uri,\n      },\n    };\n  });\n  return { items };\n}\n\nconst menuProps = generateMenuProps(dataSet, \&quot;https://example.com\&quot;);\n\ncreateMenu(menuProps);\n```\n\nとなります。\n`createMenu`を見ていると`createElement`で生成された`ul`は後から`appendChild`でElementを追加しています。これは技術的に2点、実装の思想として1点で注意する点があります。\n\n技術的には\n\n1. `HTMLElement`に`NodeList`をそのまま`appendChild`できない\n2. `appendChild`を都度行う場合パフォーマン的を下げるパターンがある\n\n実装の思想的には\n\n1. `createElement`は「子要素を追加する」処理を含む形で実装したがカバーできていない。\n\n技術的な解消方法はシンプルです。\nHTMLElementの配列（下記）を直接`appendChild`することができません。\nこれを行うには、[DocumentFragment](https://developer.mozilla.org/ja/docs/Web/API/DocumentFragment)の形式に変換した上で`appendChild`に渡す必要があります。\n\n```js\n// HTMLElementの配列の例\n[\n  &lt;li&gt;&lt;a&gt;...&lt;/a&gt;&lt;/li&gt;, // createMenuで生成したHTMLElement\n  &lt;li&gt;&lt;a&gt;...&lt;/a&gt;&lt;/li&gt;, // createMenuで生成したHTMLElement\n  &lt;li&gt;&lt;a&gt;...&lt;/a&gt;&lt;/li&gt;, // createMenuで生成したHTMLElement\n]\n```\n\nDocumentFragmentを生成するには`document.createDocumentFragment`を利用します。\n`document.createElement`と同じように扱うことができるので、`createElement`と似たようなラッパー関数を定義します。\n\n```js\nconst createFragment = ({ children }) =&gt; {\n  const fragment = document.createDocumentFragment()\n  children.forEach(child =&gt; {\n    fragment.appendChild(child);\n  });\n  return fragment;\n}\n```\n\nこれを採用すると`createMenu`は次のようにかけます。\n\n```js\nconst createMenu = (props) =&gt; {\n  const menuItems = props.items.map(createMenuItem);\n  return createElement({\n    tagName: \&quot;ul\&quot;,\n    children: createFragment(menuItems) // fragment化して渡すことでappendChildを消せた\n  });\n}\n```\n\nこれで最初に提示した**完成版**へたどり着くことができました。\n\n**参考**\n\n* DocumentFragment&lt;br /&gt;https://developer.mozilla.org/ja/docs/Web/API/DocumentFragment\n* JavaScript 大量の要素をDOMに追加する際の、createDocumentFragmentの使い方。&lt;br /&gt;https://qiita.com/39_isao/items/2fa8faed283d455f4181\n* 七章第四回　ノードをまとめて扱う：DocumentFragment&lt;br /&gt;https://uhyohyo.net/javascript/7_4.html\n\n### Step 5：応用編\n\nここまで読んでくれた方にもう少し発展系を提示します。\n**完成版**ですが、もう少し手を加えると以下のようなことができます。\n\n* `createElement`に`createFragment`を含める\n* `anchor.text =` / `anchor.href` を`createElement`の引数として渡す\n\nこれを行うことで、`createElement`がより抽象化され、`createMenu`、`createMenuItem`をシンプルに書くことができます。\n下記にそれを記すので、自分でチャレンジしたい方はまだスクロールをここで止めてください。\n\n変更した関数だけ以下に記述します。\n\n```js\nconst createElement = ({ tagName, children, ...props }) =&gt; {\n  const element = document.createElement(tagName);\n  // propsは`tagName`, `children`を除いたパラメータを受け取ることを利用し、\n  // createElementの残りのkeyを生成するHTMLElementのプロパティのキーとして利用する\n  Object.entries(props).forEach(([key, value]) =&gt; {\n    element[key] = value;\n  });\n  if (children) {\n    // 配列の場合はcreateFragmentを通す\n    element.appendChild(Array.isArray(children) ? createFragment({ children }) : children);\n  }\n  return element;\n}\n\nconst createMenuItem = (props) =&gt; {\n  return createElement({\n    tagName: \&quot;li\&quot;,\n    children: createElement({ tagName: \&quot;a\&quot;, ...props.anchor }),\n  });\n}\n\nconst createMenu = (props) =&gt; {\n  return createElement({\n    tagName: \&quot;ul\&quot;,\n    children: props.items.map(createMenuItem), // childrenは配列も受け取ることができる\n  });\n}\n```\n\nこれにより、`createMenu`と`createMenuItem`が`createElement`だけで表現できるようになりました。\n\nStep5の実装コードは[こちら](https://gist.github.com/Himenon/d1cea3447b88a9248c82d82dcac1241b)。\n\n## まとめ\n\n* 要件に対する最短のコーディングを提示し、**プロダクション環境に持っていくコードで、自分以外の人間が保守する可能性のあるコード**を前提としたリファクタリングを行いました。\n* コーディングルールを決めておくことで、命名が自動的に決定されることを紹介しました。\n\n## 最後に \n\n実は、`createElement`の引数や構造化はReactの`React.createElement`あたりを意識しつつ作っています。\nJSXを利用してReactを見ていると今回のような`createElement`はなかなか目にしませんが、本質的には近い処理を行っています。\nまた、Reactの管理下にあると、DOMの差分変更を行えたりより多くの恩恵を受けることができます。\nとはいえ、これは`createElement`を深掘って行ったときの話です。\n今回の本題はコーディングを勧めていく上の考え方を紹介することにあります。\nある程度のコーディングルールを決めておくことで命名や構造化はほとんどの場合、要件を固めた時点で確定します。\n本記事でその一端でもつかめると書いた甲斐があったなぁと思います。\n\n2019年も残すところ僅かです。みなさんんおより良い開発を願ってます！\n\nそれでは！\n&quot;},&quot;site&quot;:{&quot;title&quot;:&quot;himenon.github.io&quot;,&quot;description&quot;:&quot;早く画面から出たい人の備忘録。&quot;,&quot;baseUri&quot;:&quot;/&quot;,&quot;baseUrl&quot;:&quot;https://himenon.github.io&quot;}}"></script>
  </head>

  <body>

    <body>
      <div>
        <nav id="nav-bar">
          <div id="nav-bar-container"><a href="/">TOP</a></div>
        </nav>
        <header id="site-header">
          <div id="site-header-container">
            <h1 id="page-title">JavaScriptでHTMLを動的に生成するときの書き方の実践例</h1>
            <p id="page-description">コーディングルールを決めた上でJavaScript内で動的にDOMを生成する実装をステップを踏んで紹介します。</p>
            <p id="article-time"><span id="posted-at__label">投稿日</span><time>2019-12-16 02:00:00</time><span id="created-at__label">更新日</span><time>2019-12-17 02:00:00</time></p>
          </div>
        </header>
      </div>
      <div class="wrapper">
        <section>
          <p>2019年アドベントカレンダー ドワンゴの15日目の記事です。（過ぎてしまっていますが）</p>
          <p><a href="/blog/2019-12-14-jsconf2019-report">前日の記事</a>中でテクニカルな話が登場しなかったので、
            普段、自分がどのようにコードを書いているのかを紹介します。</p>
          <p>前提として、<strong>プロダクション環境に持っていくコードで、自分以外の人間が保守する可能性のあるコード</strong>を書くならどのように書くか、という視点で説明します。</p>
          <p>実行環境として、Google ChromeのDevToolsで動くコードを載せていきます。参考にTypeScriptの実装も載せます。</p>
          <p>いくつかのユースケースでどのように使うか紹介します。</p>
          <h2>例題：ブログの情報からメニューを生成する</h2>
          <p>たとえば本ブログもそうですが、「記事の一覧」を表示する機能を作りたい場合があります。
            ゼロから作る場合、メニューに必要な情報に対して取得できる情報に過不足が生じている場合、最終出力までに変換を入れる必要があります。</p>
          <h3>要件定義</h3>
          <p>初期データとして以下のようなものを考えます。</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> dataSet <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">"top"</span><span class="token punctuation">,</span>
    uri<span class="token punctuation">:</span> <span class="token string">"/top"</span><span class="token punctuation">,</span>
    description<span class="token punctuation">:</span> <span class="token string">"このwebサイトのTOPページ"</span><span class="token punctuation">,</span>
    tags<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"website"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">"about"</span><span class="token punctuation">,</span>
    uri<span class="token punctuation">:</span> <span class="token string">"/about"</span><span class="token punctuation">,</span>
    description<span class="token punctuation">:</span> <span class="token string">"このwebサイトの説明"</span><span class="token punctuation">,</span>
    tags<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"about"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">"blog"</span><span class="token punctuation">,</span>
    uri<span class="token punctuation">:</span> <span class="token string">"/blog"</span><span class="token punctuation">,</span>
    description<span class="token punctuation">:</span> <span class="token string">"ブログ一覧"</span><span class="token punctuation">,</span>
    tags<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"article"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
          <p>出力としてほしいものは以下のようにします。</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://example.com/top<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>top<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://example.com/about<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>about<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://example.com/blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>blog<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
</code></pre>
          <h2>最短で書いた場合</h2>
          <p><strong>取りあえず動く</strong>ことを目標に書いたコードは以下のように書けます。</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataSet<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> anchor  <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  anchor<span class="token punctuation">.</span>text <span class="token operator">=</span> item<span class="token punctuation">.</span>title<span class="token punctuation">;</span>
  anchor<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"https://example.com"</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>uri<span class="token punctuation">;</span>
  li<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ul<span class="token punctuation">;</span>
</code></pre>
          <p>これと比較して、本番環境に入れる場合のコードは次のように書いています。</p>
          <h2>完成版</h2><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">createElement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> tagName<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    element<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> element<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">createFragment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> fragment<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">createMenuItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> anchor <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token punctuation">{</span> tagName<span class="token punctuation">:</span> <span class="token string">"a"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  anchor<span class="token punctuation">.</span>text <span class="token operator">=</span> props<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span>text<span class="token punctuation">;</span>
  anchor<span class="token punctuation">.</span>href <span class="token operator">=</span> props<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token punctuation">{</span> tagName<span class="token punctuation">:</span> <span class="token string">"li"</span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> anchor <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">createMenu</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> menuItems <span class="token operator">=</span> props<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>createMenuItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token punctuation">{</span> tagName<span class="token punctuation">:</span> <span class="token string">"ul"</span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token function">createFragment</span><span class="token punctuation">(</span>menuItems<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">generateMenuProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dataSet<span class="token punctuation">,</span> baseUrl</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> items <span class="token operator">=</span> dataSet<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">param</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      anchor<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        text<span class="token punctuation">:</span> param<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
        href<span class="token punctuation">:</span> baseUrl <span class="token operator">+</span> param<span class="token punctuation">.</span>uri<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> items <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> menuProps <span class="token operator">=</span> <span class="token function">generateMenuProps</span><span class="token punctuation">(</span>dataSet<span class="token punctuation">,</span> <span class="token string">"https://example.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">createMenu</span><span class="token punctuation">(</span>menuProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
          <p>実装コードに大きな開きがあるのを見て取れます。
            なぜこのように冗長的なコードになるのか説明します。</p>
          <h2>解説編</h2>
          <p>まずは実装上のルールを以下のように定めています。</p>
          <h3>コーディングルール</h3>
          <ol>
            <li>classの生成や、DOMの生成する、などNative APIを叩く関数は接頭辞に<code>create</code>を利用する</li>
            <li>データ変換をする関数の命名は以下のようにする<ul>
                <li><code>convertAtoB([Aのパラメーター])</code>
                  <ul>
                    <li>入力するAの型が確定している場合</li>
                  </ul>
                </li>
                <li><code>generate[TargetName]([入力パラメーター])</code>
                  <ul>
                    <li>入力するパラメーターの型が<ul>
                        <li>曖昧な場合</li>
                        <li>複数存在し、1つの意味で表現できない場合</li>
                      </ul>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
            <li>DOM生成の関数のパラメーター<code>props</code>と命名する<ul>
                <li>propsはJavaScriptのObjectにする</li>
                <li>props内のキー名はpropsを利用する関数が必要とするパラメーター名にする</li>
                <li>propsの少勇者は生成する対象自身とする</li>
              </ul>
            </li>
            <li>同一スコープ内で命名がかぶる場合は、関数名に具象度が1つ高い名前を含める<ul>
                <li>スコープ内で衝突が起きなくなるまでこれを繰り返す</li>
              </ul>
            </li>
            <li>関数を以下の方針で分割する<ul>
                <li>意味のある単位<ul>
                    <li>意味 ≒ 要件</li>
                  </ul>
                </li>
                <li>同じ実装が複数回繰り返された場合</li>
                <li>Mock/Stubテストが必要となりそうなAPIを直接叩いている場合</li>
              </ul>
            </li>
          </ol>
          <p>それでは、最短で書いた場合のコードを見つつ、ルールを適用します。
            ルールをコードに適用していく際、どのようにしていくかはある程度の慣れが必要ですので、
            手を動かして検証してみてください。</p>
          <h3>Step 1：意味のある単位で分割する</h3>
          <p>最初に着手するのは要件からです。
            わかりやすのは表示の部分で、最終出力は<code>ul &gt; li &gt; a</code>という構造を持っています。
            タグだけは意味が伝わらないので、命名をします。</p><pre class="language-plain"><code class="language-plain">MenuItem : li &gt; a のHTMLElement
Menu     : ul &gt; MenuItem のHTMLElement
</code></pre>
          <p>これにより、<code>MenuItem</code>と<code>Menu</code>を生成する必要があります。
            返り値は<code>HTMLElement</code>であるため、<a href="https://developer.mozilla.org/ja/docs/Web/API/Document/createElement"><code>document.createElement</code></a>を利用することになります。
            これにより、次のように命名が確定します。</p><pre class="language-js"><code class="language-js"><span class="token comment">// document.createElementはNative APIであるため、接頭辞に`create`を採用</span>
<span class="token comment">// create + HTMLElement(生成対象)</span>
<span class="token keyword">const</span> <span class="token function-variable function">createHTMLElement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// MenuとMenuItemで名前が衝突するため、具象度を上げる</span>
<span class="token keyword">const</span> <span class="token function-variable function">createMenuItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">createMenu</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre>
          <p>これで骨格が整いました。骨格だけで実装すると、次のようになります。</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">createMenuItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> anchor <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  li<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> li<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">createMenu</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// menuItemをループで生成</span>
  <span class="token comment">// ul.appendChild(menuItem);</span>
  <span class="token keyword">return</span> ul<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">createMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
          <p>返り値の命名は<code>create[生成対象]</code>のうち、<code>生成対象</code>をcamelCaseにすると衝突しにくくなります。
            ただ、今回は<code>document.createElement</code>を挟んでいるので、ここは生成するタグ名を利用しました。</p><pre class="language-js"><code class="language-js"><span class="token comment">// 生成対象は引数に合致するため、変数名は`ul`となる</span>
<span class="token comment">// https://developer.mozilla.org/ja/docs/Web/API/HTMLAnchorElement</span>
<span class="token keyword">const</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// `create + [生成対象]`の公式に当てはめられるため、変数名は`menuItem`となる</span>
<span class="token keyword">const</span> menuItem <span class="token operator">=</span> <span class="token function">createMenuItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
          <p>余談：ちなみに、<code>a</code>タグ生成時の変数名は<code>a</code>ではないかというと、Web APIは<code>HTMLAnchorElement</code>から命名を引っ張ってきているためです。
            TypeScriptであれば、<code>React</code>の型定義を参照してみるのも良いでしょう。</p>
          <p>参考</p>
          <ul>
            <li>HTMLAnchorElement<ul>
                <li><a href="https://developer.mozilla.org/ja/docs/Web/API/HTMLAnchorElement">https://developer.mozilla.org/ja/docs/Web/API/HTMLAnchorElement</a></li>
              </ul>
            </li>
            <li><code>@types/react</code>
              <ul>
                <li><a href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/react/global.d.ts#L32">https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/react/global.d.ts#L32</a></li>
                <li><a href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/288692b272b695eda00a47f93339e1e16ee756b1/types/react/index.d.ts#L2863-L3043">https://github.com/DefinitelyTyped/DefinitelyTyped/blob/288692b272b695eda00a47f93339e1e16ee756b1/types/react/index.d.ts#L2863-L3043</a></li>
              </ul>
            </li>
          </ul>
          <h3>Step 2：引数を決定する</h3>
          <p><code>createMenu</code>と<code>createMenuItem</code>引数の名前をまずは決めましょう。
            今回は<code>document.createElement</code>で生成したDOMに対してパラメーターを渡すため、<code>props</code>という変数名になります。</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">createMenuItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">createMenu</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre>
          <p>次に、<code>props</code>（Object）の中身を決定します。
            キー名は生成するHTMLElementの名前を入れるのが良いでしょう。</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">createMenuItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// props = { anchor: {} };</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">createMenu</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// props = { items: [ { anchor: { ... } }, { anchor: { ... } } ] }</span>
<span class="token punctuation">}</span>
</code></pre>
          <p>ここで不思議だと思うのが、<code>createMenu</code>のpropsの名前が<code>props.menuItems</code>ではないことでしょう。
            実はこれルールにも書きましたが、<code>props</code>の所有者は生成対象、つまり<code>menu</code>だと考えると
            <code>menu.items</code>と読み変えることができます。これにより要件が増えた場合でも柔軟に対応できる構造を表現できます。</p>
          <p>ここまでを実装に落とすと、</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">createMenuItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> anchor <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  anchor<span class="token punctuation">.</span>text <span class="token operator">=</span> props<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span>text<span class="token punctuation">;</span>
  anchor<span class="token punctuation">.</span>href <span class="token operator">=</span> props<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
  li<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> li<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">createMenu</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  props<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> menuItem <span class="token operator">=</span> <span class="token function">createMenuItem</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>menuItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> ul<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">createMenu</span><span class="token punctuation">(</span><span class="token comment">/** Step3へ */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
          <p>と書くことができます。</p>
          <h3>Step 3：与えられたデータを変換する</h3>
          <p>Step2までではまだ実装が不十分です。<code>dataSet</code>に対して<code>createMenu</code>の引数の型が合致していません。
            そのため変換が必要となります。</p>
          <p>また、dataSetにはベースURLが存在しないため、追加する実装も必要です。
            最短の実装では次のように書いていた部分です。</p><pre class="language-js"><code class="language-js">anchor<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"https://example.com"</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>uri<span class="token punctuation">;</span>
</code></pre>
          <p>つまり、<code>dataSet</code>とベースURL<code>https://example.com</code>を利用して、<code>createMenu</code>にわたす変数を生成する関数を定義します。</p>
          <p>関数は<code>convertAtoB</code>形式か<code>generate[TargetName]</code>のどちらかになりますが、
            <code>convertAtoB</code>を採用する場合は入力する側のパラメーターが意味のある形でまとまっていなければ<code>A</code>を命名することができません。つまり、今回の場合、<code>dataSet</code>とベースURLの塊に命名ができれば利用できますが、<strong>具体的な</strong>名前が簡単には思いつかないので、<code>generate[TargetName]</code>形式の命名を行います。</p>
          <p>生成対象は<code>createMenu</code>の入力変数、つまり、<code>Menu</code>の<code>props</code> -&gt; <code>MenuProps</code>になります。
            ゆえに、</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">generateMenuProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre>
          <p>と関数名が決定されます。この関数の引数は<code>Menu</code>の<code>Props</code>を生成に必要な素材を渡すだけです。</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">generateMenuProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dataSet<span class="token punctuation">,</span> baseUrl</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre>
          <p>ここまで来たら後は変換する実装コードを書くだけになります。</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">generateMenuProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dataSet<span class="token punctuation">,</span> baseUrl</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> items <span class="token operator">=</span> dataSet<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">param</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      anchor<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        text<span class="token punctuation">:</span> param<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
        href<span class="token punctuation">:</span> baseUrl <span class="token operator">+</span> param<span class="token punctuation">.</span>uri<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> items <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
          <p>これで完成です。結合してみると、</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">createMenuItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> anchor <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  anchor<span class="token punctuation">.</span>text <span class="token operator">=</span> props<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span>text<span class="token punctuation">;</span>
  anchor<span class="token punctuation">.</span>href <span class="token operator">=</span> props<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
  li<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> li<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">createMenu</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  props<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> menuItem <span class="token operator">=</span> <span class="token function">createMenuItem</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>menuItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> ul<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">generateMenuProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dataSet<span class="token punctuation">,</span> baseUrl</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> items <span class="token operator">=</span> dataSet<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">param</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      anchor<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        text<span class="token punctuation">:</span> param<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
        href<span class="token punctuation">:</span> baseUrl <span class="token operator">+</span> param<span class="token punctuation">.</span>uri<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> items <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> menuProps <span class="token operator">=</span> <span class="token function">generateMenuProps</span><span class="token punctuation">(</span>dataSet<span class="token punctuation">,</span> <span class="token string">"http://example.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">createMenu</span><span class="token punctuation">(</span>menuProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
          <p>ほとんどこれで完成と言っても問題ないでしょう。
            Step 4移行は体裁を整えてい作業を行います。</p>
          <h3>Step 4：関数をまとめる</h3>
          <p>まずやることは関数の分割です。同じような実装を少しだけ抽象化して、まとめていきます。
            目にとまるのは、<code>document.createElement</code>の部分です。</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
li<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token comment">/** Children */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
          <p>このような組み合わせが散見されます。<code>appendChild</code>を利用しない場合もあるので、分岐が必要です。
            DOMを生成する関数を定義する場合、<code>props</code>という引数を定義しますが、今回はもう少し簡潔に書いてみましょう。
            <code>createElement</code>という関数を新たに作り、「指定されたタグのHTMLElementを生成し、子要素を追加する」処理を与えましょう。</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">createElement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> tagName<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    element<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> element<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
          <p>名前の衝突がない場合、<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">分割代入</a>を行うと
            冗長な書き方が避けられます。</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> tagName<span class="token punctuation">,</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span> <span class="token comment">// 分割代入</span>
</code></pre>
          <p>新しく定義した<code>createElement</code>を利用すると、</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">createElement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> tagName<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    element<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> element<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">createMenuItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> anchor <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token punctuation">{</span> tagName<span class="token punctuation">:</span> <span class="token string">"a"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  anchor<span class="token punctuation">.</span>text <span class="token operator">=</span> props<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span>text<span class="token punctuation">;</span>
  anchor<span class="token punctuation">.</span>href <span class="token operator">=</span> props<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token punctuation">{</span> tagName<span class="token punctuation">:</span> <span class="token string">"li"</span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> anchor <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">createMenu</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ul <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token punctuation">{</span> tagName<span class="token punctuation">:</span> <span class="token string">"ul"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  props<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> menuItem <span class="token operator">=</span> <span class="token function">createMenuItem</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>menuItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> ul<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">generateMenuProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dataSet<span class="token punctuation">,</span> baseUrl</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> items <span class="token operator">=</span> dataSet<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">param</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      anchor<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        text<span class="token punctuation">:</span> param<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
        href<span class="token punctuation">:</span> baseUrl <span class="token operator">+</span> param<span class="token punctuation">.</span>uri<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> items <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> menuProps <span class="token operator">=</span> <span class="token function">generateMenuProps</span><span class="token punctuation">(</span>dataSet<span class="token punctuation">,</span> <span class="token string">"https://example.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">createMenu</span><span class="token punctuation">(</span>menuProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
          <p>となります。
            <code>createMenu</code>を見ていると<code>createElement</code>で生成された<code>ul</code>は後から<code>appendChild</code>でElementを追加しています。これは技術的に2点、実装の思想として1点で注意する点があります。</p>
          <p>技術的には</p>
          <ol>
            <li><code>HTMLElement</code>に<code>NodeList</code>をそのまま<code>appendChild</code>できない</li>
            <li><code>appendChild</code>を都度行う場合パフォーマン的を下げるパターンがある</li>
          </ol>
          <p>実装の思想的には</p>
          <ol>
            <li><code>createElement</code>は「子要素を追加する」処理を含む形で実装したがカバーできていない。</li>
          </ol>
          <p>技術的な解消方法はシンプルです。
            HTMLElementの配列（下記）を直接<code>appendChild</code>することができません。
            これを行うには、<a href="https://developer.mozilla.org/ja/docs/Web/API/DocumentFragment">DocumentFragment</a>の形式に変換した上で<code>appendChild</code>に渡す必要があります。</p><pre class="language-js"><code class="language-js"><span class="token comment">// HTMLElementの配列の例</span>
<span class="token punctuation">[</span>
  <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>a<span class="token operator">></span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span class="token punctuation">,</span> <span class="token comment">// createMenuで生成したHTMLElement</span>
  <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>a<span class="token operator">></span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span class="token punctuation">,</span> <span class="token comment">// createMenuで生成したHTMLElement</span>
  <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>a<span class="token operator">></span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span class="token punctuation">,</span> <span class="token comment">// createMenuで生成したHTMLElement</span>
<span class="token punctuation">]</span>
</code></pre>
          <p>DocumentFragmentを生成するには<code>document.createDocumentFragment</code>を利用します。
            <code>document.createElement</code>と同じように扱うことができるので、<code>createElement</code>と似たようなラッパー関数を定義します。</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">createFragment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> fragment<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
          <p>これを採用すると<code>createMenu</code>は次のようにかけます。</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">createMenu</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> menuItems <span class="token operator">=</span> props<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>createMenuItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    tagName<span class="token punctuation">:</span> <span class="token string">"ul"</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> <span class="token function">createFragment</span><span class="token punctuation">(</span>menuItems<span class="token punctuation">)</span> <span class="token comment">// fragment化して渡すことでappendChildを消せた</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
          <p>これで最初に提示した<strong>完成版</strong>へたどり着くことができました。</p>
          <p><strong>参考</strong></p>
          <ul>
            <li>DocumentFragment<br /><a href="https://developer.mozilla.org/ja/docs/Web/API/DocumentFragment">https://developer.mozilla.org/ja/docs/Web/API/DocumentFragment</a></li>
            <li>JavaScript 大量の要素をDOMに追加する際の、createDocumentFragmentの使い方。<br /><a href="https://qiita.com/39_isao/items/2fa8faed283d455f4181">https://qiita.com/39_isao/items/2fa8faed283d455f4181</a></li>
            <li>七章第四回　ノードをまとめて扱う：DocumentFragment<br /><a href="https://uhyohyo.net/javascript/7_4.html">https://uhyohyo.net/javascript/7_4.html</a></li>
          </ul>
          <h3>Step 5：応用編</h3>
          <p>ここまで読んでくれた方にもう少し発展系を提示します。
            <strong>完成版</strong>ですが、もう少し手を加えると以下のようなことができます。</p>
          <ul>
            <li><code>createElement</code>に<code>createFragment</code>を含める</li>
            <li><code>anchor.text =</code> / <code>anchor.href</code> を<code>createElement</code>の引数として渡す</li>
          </ul>
          <p>これを行うことで、<code>createElement</code>がより抽象化され、<code>createMenu</code>、<code>createMenuItem</code>をシンプルに書くことができます。
            下記にそれを記すので、自分でチャレンジしたい方はまだスクロールをここで止めてください。</p>
          <p>変更した関数だけ以下に記述します。</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">createElement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> tagName<span class="token punctuation">,</span> children<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// propsは`tagName`, `children`を除いたパラメータを受け取ることを利用し、</span>
  <span class="token comment">// createElementの残りのkeyを生成するHTMLElementのプロパティのキーとして利用する</span>
  Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    element<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 配列の場合はcreateFragmentを通す</span>
    element<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">createFragment</span><span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> element<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">createMenuItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    tagName<span class="token punctuation">:</span> <span class="token string">"li"</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token punctuation">{</span> tagName<span class="token punctuation">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token operator">...</span>props<span class="token punctuation">.</span>anchor <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">createMenu</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    tagName<span class="token punctuation">:</span> <span class="token string">"ul"</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> props<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>createMenuItem<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// childrenは配列も受け取ることができる</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
          <p>これにより、<code>createMenu</code>と<code>createMenuItem</code>が<code>createElement</code>だけで表現できるようになりました。</p>
          <p>Step5の実装コードは<a href="https://gist.github.com/Himenon/d1cea3447b88a9248c82d82dcac1241b">こちら</a>。</p>
          <h2>まとめ</h2>
          <ul>
            <li>要件に対する最短のコーディングを提示し、<strong>プロダクション環境に持っていくコードで、自分以外の人間が保守する可能性のあるコード</strong>を前提としたリファクタリングを行いました。</li>
            <li>コーディングルールを決めておくことで、命名が自動的に決定されることを紹介しました。</li>
          </ul>
          <h2>最後に</h2>
          <p>実は、<code>createElement</code>の引数や構造化はReactの<code>React.createElement</code>あたりを意識しつつ作っています。
            JSXを利用してReactを見ていると今回のような<code>createElement</code>はなかなか目にしませんが、本質的には近い処理を行っています。
            また、Reactの管理下にあると、DOMの差分変更を行えたりより多くの恩恵を受けることができます。
            とはいえ、これは<code>createElement</code>を深掘って行ったときの話です。
            今回の本題はコーディングを勧めていく上の考え方を紹介することにあります。
            ある程度のコーディングルールを決めておくことで命名や構造化はほとんどの場合、要件を固めた時点で確定します。
            本記事でその一端でもつかめると書いた甲斐があったなぁと思います。</p>
          <p>2019年も残すところ僅かです。みなさんんおより良い開発を願ってます！</p>
          <p>それでは！</p>
        </section>
      </div>
    </body>
  </body>

</html>