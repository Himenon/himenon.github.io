# Kubeflow Meetup #1に行ってきた

※ 筆者はMLをすこーしKaggleで遊んで、Kubernetesは少し業務で使ったことのあるくらいの知識しか保有してないです。（ほんとに）

なので、せめてメモしたことくらいは残しておきます。

## イベント内容

* 日時：2018 年 9 月 26 日 (水)
* 会場：株式会社Preferred Networks
* イベントページ：[Kubeflow Meetup \#1（Cloud Native Meetup Tokyo \#5） \- connpass](https://cloudnative.connpass.com/event/100600/)

# 発表

## Katib(ハイパーパラメータチューニング)

<iframe src="//www.slideshare.net/slideshow/embed_code/key/1xd85QmWzsNXnP" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/Oshima0x3fd/kubeflow-meetup-1-katib" title="KubeFlow MeetUp #1 Katibよもやま話" target="_blank">KubeFlow MeetUp #1 Katibよもやま話</a> </strong> from <strong><a href="https://www.slideshare.net/Oshima0x3fd" target="_blank">Yuji Oshima</a></strong> </div>

#kfmmetup

OSS活動が主な業務
KubeFlow/Katibのオーナー
Kubernetes城に機械学習基盤を構築するOSSプロジェクト

KubeCon2017NAにてGoogleが発表
6月末に登場

KubeFlowが登場した理由
機械学習サービスの課題
実サービスとしてMLコンポーネントを開発「運用」する際の課題
TensrFlow Extended(TFX)
Google Playを運用する基盤
TFXの設計思想...
TFで開発 --> TFXに載せる（Borg上）
TFとBorgはOSSとして成熟
TFXがOSSとしてでてきていいのじゃないか？ということで、KubeFlowがでてきた
機械学習をもっと簡単にサービスに！
とのことです。
KFの実装に踏み込んだMeetUpは世界でもほぼない
KubeFlowのComponentのオーナーがこの会場に何人かいます
KubeFlowとは何か、もう少し話します。
*KubeFlow Pipeline*
Pipeline全てをカバーするOSSではなく、KubeFlow Componentsを連結しやすくしている、やーつ
KubeFlowの
Getting Start
*まずはk8sクラスタを用意しましょう*
わろた
KubeFlowをデプロイするというのはどういうことか？
k8sのコンテナが乗っかるっぽい
DEMO中
Kubeflow Central UIはただのリンク集
Jupyter Hubを押すと、Jupyter Hubがでてくる
Ownerが出てくる
TF Job Dashboardもある
Tensorflow Operatorを使って、簡単にTensorflowがデプロイできるようになる
Workerの設定や、パラメーターサーバーのせってい、コマンド、画像などが設定できる
GUIだけでデプロイできる
あー、この発表すごくわかりやすいので、
ぜひ見てくだせえ
Q. Kubeflowを試すのに必要なリソースは？
最終的には機械学習で使うリソースで決まる
===== 切り取り線 =====
*Katib* の話
ハイパーパラメータチューニングのフレームワーク
GoogleがTFXと同時にKDD2017で発表したVizierがモデル
サポートするアルゴリズム。

Kosei Himeno [7:26 PM]
Random Grid HyperBand ...

Kosei Himeno [7:28 PM]
これからぜんたいのJOBの流れについて話します
パラメータの埋め込みはどうやっているか？メトリックスはどうやって撮っているか？
JOB全体の流れは、kubectl apply -f study-job.yml できまる
ApiVerwion: "kubeflow.org/..." なやつ
ジョブ全体の流れはkubernetesのkube-proxyとかcontrollerと似ているな
Kataib ManagerがCore DNSにアルゴリズムがあるか問い合わせる
K8sと似てるなー
僕の考えた最強のアルゴリズムが死んでも、Managerが切り替えてくれる
Metrics CollectorはCron Jobで動いている。
*Katibまとめ*
並列でパラメータtuningを行えるフレームワーク
• アルゴリズムの追加も用意
• tuningアルゴリズム自体のテスト、開発も容易
Q. アルゴリズムを変えると性能は大きく変わることがあるか？ (edited)
ありえます。


## KubeFlowオペレータ

<iframe src="//www.slideshare.net/slideshow/embed_code/key/2pcUXdzvciaTvE" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/pfi/20180926-kubeflowmeetup1kubeflowoperatorspreferred-networksshingo-omura" title="20180926 kubeflow-meetup-1-kubeflow-operators-Preferred Networks-Shingo Omura" target="_blank">20180926 kubeflow-meetup-1-kubeflow-operators-Preferred Networks-Shingo Omura</a> </strong> from <strong><a href="https://www.slideshare.net/pfi" target="_blank">Preferred Networks</a></strong> </div>

*Kubeflow Operators*
Preferred Networksの人
GPU ClusterのDev/Opsをやっています。
chainerのusabilityを向上するようにがんばってる
Twitter everpeace

今日のトピックは、Kubeflowの中のTraining
Kubeflowは数カスのML frameworksをサポートしている
PyTorch
どうやって複数のMLをサポートしているか
Operators and CRDs
Kubernetes Operator Patternで検索すると出てくる
CRD = Custom Resource Definition
```kind: CustomResourceDefinition
spec:
    Kind: MyKind```
独自のkindを用意できる (edited)
OperatorはCustom ResourceとCluster Stateを監視する
Kubeflowは複数のMLをサポートするために、
OperatorsとCRDsを用意した
CRDsはSingle-node, multi-nodeをサポートしている
`ksonnet` にKubeflowは依存している
Ksonnetとは、k8sにとっては
YAMLをレンダリングするやつ（helmみたいなやつ）
KubeflowのOperatorがどのようにはたらいているか
• Parameter Server Style
• All-Reduce Style (edited)
よく見るYAMLなので、機械学習がよく話からに僕でもなにをやっているのかわかる (edited)
Tf-operatorはtf-Jobをwatchしている。podsも。
Chainer Job Structure (All-Rreduce style)

Master 最初にspwanするやつ
K8sのjobに展開される (edited)
Workerは基本的に寝ていて、masterからしれいをうけたらstatefullsetで立ち上がる
DEMO

## Argo

<iframe src="//www.slideshare.net/slideshow/embed_code/key/McufB6VKowQcqu" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/shunyaueta/introduction-to-argo-116672516" title="Introduction to argo" target="_blank">Introduction to argo</a> </strong> from <strong><a href="https://www.slideshare.net/shunyaueta" target="_blank">Shunya Ueta</a></strong> </div>

*Introduction to Argo*
Twitter hurutoriya
メルカリ 機械学習エンジニア

Argoの守備範囲（火星）
Version 2.2.0
コンテナネイティブなワークフロー園児n
実務で使うのは結構きつい
Workflowエンジンだと、Airflow, DigDag
が他にある
Argo-ui: ワークフローのダッシュボードを提供
機械学習エンジンをデプロイしようとすると、前処理に関する複雑なパイプラインが乱立する
Container as a Package
コンテナをパッケージのように使う
TensorFlow ExtendはPython2でしか動かないのw
（Apache Beamのえいきょう）
Argo: Continuous Delivery
Argoproj/argo-cd
Ksonnet, kustomize, helmなどが読み込める
Argo: Events
Sensor: singals, triggersを包括する概念
Signals: 駆動方法/ Stream, Artifact, Calendar, Resource, Webhook
Triggers: 実行方法/ inline, file, url
Dashboardの限界がプロダクションでは見える
20くらい並列で動かした時、
グラフが見えた時はうれしいけど、なんの意味もない
Q. DataSetはどう管理していますか？
A. 規模がでかいとNetwork I/Oで時間がかかるので、Cloud Storageをマウントしています。

# LT


K8sちょっとできる DL/DM全くわからん

期待
* MLモデル向けのPaaSのようななにか
* jupyterで完結するのかな？
と思っていた

KubeFlowのcentral dashboardを期待してみたらこれでした（なにもない）
権限追加しないとうごかなかった
Notebookにコピペして動かしてみたら動かない...!
Tfのバージョンアップで互換性がなくなっていた
Aliasはりまくった
ざっくりとしたモデルの開発 --> 利用
入力データをNotebookに送る、学習・テストデータの生成、学習、利用
隠れ層に何かを入力するところは職人芸が入りそうで、わからなかった
実際に試してみて思ったこと
「下準準備がたいへn」
Kubeflow/arena kubeflow用のcli
つgのLT
今日のお題
Kubeflow Project: Deep Dive
KubeflowのコミッターにこれほしいっていうLTだw
一瞬話題になったCometML
* モデルをどう残すか
Model ManagementはKubeflowはありますか？（教えてください）

*Seldon触ってみた*
* Seldonを使うと複雑な水路nパイプラインを割と簡単に実装できる
* Seldonで利用しているs2iというツールを使うと任意の機械学習モデルから、Rest API/gRPC APIを提供するdockerイメージを、おkまんどで作ることができる
* seldonを試すにはGoogle MarketPlaceを使った方が楽
機械学習モデルの入出力形式なんて決まっているでしょ？

んなことはない
制度が下がっている気がする。たぶん --> モニタリングしないといけない。
モデルの比較をしたい --> A/Bテスト
これを解決しようとしているのがSeldon
複雑な推論ぱいぷらいnをグラフとして表現する
単一のModelノードを使って機械学習モデルによる推論を行う。
--> ABテストをしたくなったら、Routerをつかって2つのModelをランダムに振り分ける
バンディットもできる

