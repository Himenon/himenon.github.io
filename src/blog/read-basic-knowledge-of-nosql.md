---
title: "NOSQLとは何か... "
createdAt: 2019-05-21 10:46:07
updatedAt: 2019-05-21 10:46:07
---

# NOSQLとは何か... 

<p id="created_at">作成日: <time dateTime="2018-02-24T23:00">2018/02/24</time></p>

NOSQLの知識が欲しかったので、ちょっと古いが次の本を読んだ。

> **NOSQLの基礎知識 (ビッグデータを活かすデータベース技術)**
>
>- 作者: 本橋信也,河野達也,鶴見利章,太田洋
>- 出版社/メーカー: リックテレコム
>- 発売日: 2012/04/25
>- <http://www.ric.co.jp/book/contents/book_887.html>

逆引き的に自分なりにまとめておく。

ただし、出版日が数年前なだけあって、既に古いと思われる部分はなるべく書かないか、
明記しておく。

## 逆引き

### ビッグデータ

小さなデータが膨大に集まって、全体として大きなデータとなっているもの

### ラージオブジェクト

1つのファイルサイズが大きいもの

### 結果整合性

ビッグデータ環境

### SQL

行と列で構成されるテーブル形

- MySQL
- Postgres

### KVS

KeyとValueの組からなるデータ

- Redis
- Dynamo

### カラム指向型

Key/Value形式を拡張したもので、行だけでなく、列に対して
動的に追加することができる。

- BigTable

### ドキュメント思考型

JSON、BSOM、XMLといったデータ記述書式で記されたドキュメント型

- CouchDB
- MongoDB

### スケールアップ

サーバーのハードウェア自体の強化

### スケールアウト

サーバー自体の数を増やす

### シャーディング

複数のサーバーにデータを分割する方法

### CAP定理

- **C**onsistency: 整合性
- **A**vailability: 可用性
- **P**artitions: 分断耐性

分散システムにおいて、C、A、Pの3つのうち最大で2つしか満たすことができない、という定理

[CAP定理 - Wikipedia](https://ja.wikipedia.org/wiki/CAP%E5%AE%9A%E7%90%86)

### ACID

トランザクションの実行保証をするために、
データベースに求められる4つの特性

- **A**tomicity（原子性）
- **C**onsistency（一貫性）
- **I**solation（独立性）
- **D**urability（耐久性）

[ACID (コンピュータ科学) - Wikipedia](https://ja.wikipedia.org/wiki/ACID_(%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E7%A7%91%E5%AD%A6))

### BASE

> BASEとは、「アプリケーションは基本的にどんなときでも動き(Basicallly Available)、常に整合性を保つ必要はないが(Soft-state)、結果として整合性がとれる状態に至る(Eventual Consistency)という特性」
> p83

- **B**asically **A**vailable
- **S**oft-state
- **E**ventual Consistencty

### Quorum(クォーラム)

議決に必要な定足数。

- N: レプリカの数
- R: ノードから読み出す数
- W: ノードに書き込む数

```
R + W > Nの場合には整合性が保証できる。
```

`R+W`がノード数より大きい場合、**結果的に**書き込みが完了したデータを読み込むことができる、ということ。

### ベクタークロック(Vector Clocks)/タイムスタンプ(Timestamp)

複数のクライアントからの同時更新があった場合に、
どのようにデータのバージョンを管理し、最終的な仲裁を行うか、
という課題に対する、代表的な解決方法。

**タイムスタンプ**

- 「新しいものが勝つ」という方法。
- サーバー側、クライアント側のどちらでも決定して良い。

**ベクタークロック**

整合性を確保する際に用いる手法の1つ。

- <http://www.atmarkit.co.jp/ait/articles/1211/05/news007_3.html>

### コンシステント・ハッシング(Consistent Hashing)

ノードをリング状に配置し、ハッシュ値を元に
それらのノードに書き込みを行っていく方法。
キーの値が特定の値に偏ることなく拡散するようにする。

### Log Structured Merge Tree (LSM-Tree)

Bigtableに触発されたNOSQLのデータベースが含む技術。
メモリを使って応答性能を高めながら、ハードディスクにデータを書くのすることで、データの安全性を保つ。

メリット

- 書き込み性能が非常に高い

デメリット

- 読み込み性能の低下(※おそらくHDDの場合。SSDは話が変わる)

読み込み性能を低下を軽減させるために、定期的にコンパクションを行い、
SS Tableの数を少なくする。

### Mem table

メモリーキャッシュ領域に存在。

### Commit Log

履歴情報をディスク内で保持

### SS Table

永続ボリュームに格納

### メタデータ(Meta Data)テーブル

### ルートテーブル

### CAS(Check And Swap)

ある値の更新時に、その値が自分以外のプロセスによって更新されていないか確認し、
自分のみが更新していると確認できた上で、更新処理を適用するオペレーション。

### Hadoop MapReduce

> 複数のサーバーを用いて、大量のデータを並列分散処理するプログラミングのためのソフトウェア
> ある一定期間のデータを集めた上で一括処理するために用いられる。
> p121

### HDFS(Hadoop Distributed File System)

マスタ型。MapReduceのデータ入出力として使用したトキに、最大の性能を発揮するように設計されている。

### MapReduce処理

**Mapタスク**

データを分解して必要な情報を抽出し、有用な形へ変換する役割

分散処理することで、現実的な時間で処理が終わる

**Reduceタスク**

抽出された情報を集約し、一塊のデータとして出力する役割



## TODO

図の挿入

{!assets/doc-templates/last-message.md.tpl!}

