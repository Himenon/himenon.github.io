(window.webpackJsonp=window.webpackJsonp||[]).push([[120],{188:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"metadata",(function(){return l})),t.d(n,"rightToc",(function(){return c})),t.d(n,"default",(function(){return p}));var r=t(3),a=t(7),o=(t(0),t(211)),i={title:"JSON\u304b\u3089OpenAPI\u306eSchema\u3092\u751f\u6210\u3059\u308b",description:"\u5de8\u5927\u306aJSON\u3092OpenAPI\u306eSchema\u306b\u843d\u3068\u3057\u8fbc\u3080\u306e\u306f\u5927\u5909\u306a\u306e\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u4ed5\u4e0a\u3052\u307e\u3057\u305f\u3002",keywords:["TypeScript","JavaScript","API","OpenAPI","Swagger","CodeGen"],createdAt:new Date("2020-11-10T15:00:00.000Z"),updatedAt:new Date("2020-11-10T15:00:00.000Z"),image:"docs/openapi/images/build-pipeline.png"},l={unversionedId:"openapi/json-to-openapi-schema",id:"openapi/json-to-openapi-schema",isDocsHomePage:!1,title:"JSON\u304b\u3089OpenAPI\u306eSchema\u3092\u751f\u6210\u3059\u308b",description:"\u5de8\u5927\u306aJSON\u3092OpenAPI\u306eSchema\u306b\u843d\u3068\u3057\u8fbc\u3080\u306e\u306f\u5927\u5909\u306a\u306e\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u4ed5\u4e0a\u3052\u307e\u3057\u305f\u3002",source:"@site/docs/openapi/json-to-openapi-schema.md",slug:"/openapi/json-to-openapi-schema",permalink:"/docs/openapi/json-to-openapi-schema",editUrl:"https://github.com/Himenon/himenon.github.io/edit/default/docs/openapi/json-to-openapi-schema.md",version:"current",sidebar:"someSidebar",previous:{title:"OpenAPI(Swagger)\u3092\u5229\u7528\u3057\u3066TypeScript\u306eAPI Client\u3092\u81ea\u52d5\u751f\u6210\u3059\u308b\u8a2d\u8a08\u3068\u5b9f\u88c5",permalink:"/docs/openapi/typescript-code-gen"},next:{title:"WEB\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u304a\u3051\u308bGoogle Analytics\u306e\u5c0e\u5165\u3068\u5b9f\u88c5\u306e\u624b\u5f15",permalink:"/docs/google-analytics/index"}},c=[{value:"\u5b9f\u88c5\u30b3\u30fc\u30c9",id:"\u5b9f\u88c5\u30b3\u30fc\u30c9",children:[]},{value:"\u4f7f\u3044\u65b9",id:"\u4f7f\u3044\u65b9",children:[]},{value:"\u6700\u5f8c\u306b",id:"\u6700\u5f8c\u306b",children:[]}],s={rightToc:c};function p(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},s,t,{components:n,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"\u5b9f\u88c5\u30b3\u30fc\u30c9"},"\u5b9f\u88c5\u30b3\u30fc\u30c9"),Object(o.b)("p",null,"\u6e96\u5099"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-ts"}),"yarn add -D typescript ts-node @types/node json2yaml\n")),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"json2schema.ts"),"\u3068\u3057\u3066\u6b21\u306e\u30b3\u30fc\u30c9\u3092\u4fdd\u5b58\u3057\u307e\u3059\u3002"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-typescript"}),'import * as fs from "fs";\n// eslint-disable-next-line @typescript-eslint/no-var-requires\nconst json2yaml = require("json2yaml");\n\nconst isNull = (value: any): value is null => {\n  return value === null;\n};\n\nconst isObject = (value: any): value is object => {\n  return typeof value === "object" && !Array.isArray(value) && value !== null;\n};\n\nconst isString = (value: any): value is string => {\n  return typeof value === "string";\n};\n\nconst isInteger = (value: any): value is number => {\n  return typeof value === "number";\n};\n\nconst isArray = (value: any): value is any[] => {\n  return typeof value === "object" && Array.isArray(value);\n};\n\nconst getStringProp = (nullable?: boolean, description?: string) => {\n  return {\n    type: "string",\n    nullable,\n    description,\n  };\n};\n\nconst getObjectProp = (properties: {}, nullable?: boolean) => {\n  return {\n    type: "object",\n    nullable,\n    properties,\n    additionalProperties: false,\n  };\n};\n\nconst getIntegerProp = (nullable?: boolean) => {\n  return {\n    type: "integer",\n    nullable,\n  };\n};\n\nconst getArrayProp = (children?: string | any, nullable?: boolean) => {\n  const items = typeof children === "string" ? { type: children } : children;\n  return {\n    type: "array",\n    items,\n    nullable,\n  };\n};\n\nconst convertChild = (value: any, objectConvert?: any): any => {\n  if (isString(value)) {\n    return getArrayProp(getStringProp());\n  } else if (isInteger(value)) {\n    return getArrayProp(getIntegerProp());\n  } else if (isObject(value)) {\n    return getObjectProp(objectConvert(value));\n  } else if (isArray(value)) {\n    return getArrayProp(convertChild(value));\n  }\n  throw new Error("\u308f\u304b\u3089\u3093" + value);\n};\n\nconst convert = (obj: { [key: string]: any }) => {\n  const result: { [key: string]: any } = {};\n  Object.keys(obj).forEach((key) => {\n    const value = obj[key];\n    if (isString(value)) {\n      result[key] = getStringProp();\n    } else if (isInteger(value)) {\n      result[key] = getIntegerProp();\n    } else if (isNull(value)) {\n      result[key] = getStringProp(true, "Unknown Type");\n    } else if (isObject(value)) {\n      result[key] = getObjectProp(convert(value));\n    } else if (isArray(value)) {\n      if (value.length > 0) {\n        result[key] = getArrayProp(convertChild(value[0], convert));\n      } else {\n        console.log(\n          `key = ${key} \u306f\u914d\u5217\u306e\u9577\u3055\u304c0\u306e\u305f\u3081\u3001\u8a73\u7d30\u306e\u60c5\u5831\u304c\u8a18\u8f09\u3055\u308c\u307e\u305b\u3093`\n        );\n        result[key] = getArrayProp("object");\n      }\n    }\n  });\n  return result;\n};\n\n/**\n * jsonToOas2 sample.json\n */\nconst main = () => {\n  const filename = process.argv[2] as string;\n  if (typeof filename !== "string") {\n    console.error("\u8aad\u307f\u3053\u3080json\u306e\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044");\n    return;\n  }\n  const data = JSON.parse(fs.readFileSync(filename, { encoding: "utf-8" }));\n  const result = convertChild(data, convert);\n  console.log(json2yaml.stringify(result)); // \u51fa\u529b\u5148\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3066\u3082\u826f\u3044\n};\n\nmain();\n')),Object(o.b)("h2",{id:"\u4f7f\u3044\u65b9"},"\u4f7f\u3044\u65b9"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"yarn run ts-node ./json2schema.ts sample.json > schema.yml\n")),Object(o.b)("p",null,"\u591a\u5c11\u3044\u3089\u306a\u3044\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u9069\u5b9c\u524a\u9664\u3057\u3066\u4f7f\u3063\u3066\u304f\u3060\u3055\u3044\u3002"),Object(o.b)("h2",{id:"\u6700\u5f8c\u306b"},"\u6700\u5f8c\u306b"),Object(o.b)("p",null,"\u3053\u306e\u5b9f\u88c5\u30b3\u30fc\u30c9\u306f",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/Himenon/openapi-typescript-practice"}),"Himenon/openapi-typescript-practice"),"\u306b\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002"))}p.isMDXComponent=!0},211:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return g}));var r=t(0),a=t.n(r);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=a.a.createContext({}),p=function(e){var n=a.a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},u=function(e){var n=p(e.components);return a.a.createElement(s.Provider,{value:n},e.children)},y={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},b=a.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),u=p(t),b=r,g=u["".concat(i,".").concat(b)]||u[b]||y[b]||o;return t?a.a.createElement(g,l(l({ref:n},s),{},{components:t})):a.a.createElement(g,l({ref:n},s))}));function g(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=b;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=t[s];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);